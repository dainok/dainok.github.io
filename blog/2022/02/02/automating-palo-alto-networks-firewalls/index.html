<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > Automating Palo Alto Networks firewalls</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="I spent a few Twitch sessions speaking about the automation of Palo Alto Networks firewalls. We used different approaches than the one used with Cisco devices. Initially, we developed a few simple Ansible playbooks."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="Automating Palo Alto Networks firewalls"><meta property="og:description" content="I spent a few Twitch sessions speaking about the automation of Palo Alto Networks firewalls. We used different approaches than the one used with Cisco devices. Initially, we developed a few simple Ansible playbooks."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2022/02/02/automating-palo-alto-networks-firewalls/"><meta property="og:image" content="https://www.adainese.it/ansible-with-panw.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-02-02T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-02T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.itansible-with-panw.png"><meta name=twitter:title content="Andrea Dainese > Automating Palo Alto Networks firewalls"><meta name=twitter:description content="I spent a few Twitch sessions speaking about the automation of Palo Alto Networks firewalls. We used different approaches than the one used with Cisco devices. Initially, we developed a few simple Ansible playbooks."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>Automating Palo Alto Networks firewalls</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#ansible-with-palo-alto-networks-firewall>Ansible with Palo Alto Networks firewall</a><ul><li><a href=#getting-facts>Getting facts</a></li><li><a href=#sending-operational-commands>Sending operational commands</a></li><li><a href=#sending-configuration-commands>Sending configuration commands</a></li><li><a href=#configuration-templating>Configuration templating</a></li></ul></li><li><a href=#programming-the-firewall-using-external-feeds>Programming the firewall using external feeds</a><ul><li><a href=#installing-django>Installing Django</a></li><li><a href=#creating-the-django-application>Creating the Django application</a></li><li><a href=#modeling>Modeling</a></li><li><a href=#admin-page>Admin page</a></li><li><a href=#printing-edls>Printing EDLs</a></li><li><a href=#starting-the-server>Starting the server</a></li><li><a href=#using-the-edl-from-a-panw-firewall>Using the EDL from a PANW firewall</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2026/01/11/filtering-cisco-api-output/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2026/01/11/filtering-cisco-api-output/>Filtering Cisco API Output</a><br><i class="fa fa-calendar"></i>
January 11, 2026</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2026/01/04/finding-cisco-aci-classes-with-visore/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2026/01/04/finding-cisco-aci-classes-with-visore/>Finding Cisco ACI Classes with Visore</a><br><i class="fa fa-calendar"></i>
January 04, 2026</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/12/28/cisco-aci-classes/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/12/28/cisco-aci-classes/>Cisco ACI Classes</a><br><i class="fa fa-calendar"></i>
December 28, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/12/21/first-approach-to-cisco-aci-apis/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/12/21/first-approach-to-cisco-aci-apis/>First Approach to Cisco ACI APIs</a><br><i class="fa fa-calendar"></i>
December 21, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/12/14/automating-user-management-with-n8n-and-ai-agents/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/12/14/automating-user-management-with-n8n-and-ai-agents/>Automating user management with n8n and AI Agents</a><br><i class="fa fa-calendar"></i>
December 14, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 176 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 140 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>Automating Palo Alto Networks firewalls</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
February 02, 2022</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/automation/ title="All posts under Automation">Automation</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw.webp><img class="img-fluid w-25 rounded shadow float-right" src=/blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw.webp alt="Post cover"></a></div><p>I spent a few Twitch sessions speaking about the automation of Palo Alto Networks firewalls. We used different approaches than the one used with Cisco devices. Initially, we developed a few simple Ansible playbooks. In the last sessions, we developed a very small Django web application to programmatically enable and disable network flows.</p><h2 id=ansible-with-palo-alto-networks-firewall>Ansible with Palo Alto Networks firewall</h2><p>The Palo Alto Networks module for Ansible has some prerequisites:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install pan-os-python pan-python pandevice xmltodict requests requests_toolbelt
</span></span></code></pre></div><p>See the first episode (S01E01) then install PAN-OS Ansible collection:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ansible-galaxy collection install paloaltonetworks.panos
</span></span></code></pre></div><p>The <code>interpreter_python</code> on <code>ansible.cfg</code> file must point to the interpreter with the PanOS libraries installed. This is important if you&rsquo;re using a virtual environment.</p><p><a data-fancybox=gallery href=/blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw.webp><img sizes="500 761 " srcset="/blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw_huab87c7201e7f379f4f0d0e23e86c4e9a_6142_500x0_resize_q75_h2_box_2.webp /blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw.webp" src=/blog/2022/02/02/automating-palo-alto-networks-firewalls/ansible-with-panw.webp alt="Ansible with Palo Alto Networks firewalls" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Firewall credentials are not passed in the standard way, but a specific dictionary must be passed to each task. We
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-1-facts.yml title=playbook-1-facts.yml target=_blank rel=noopener>populated</a>
the dictionary from Ansible parameters as following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>set_fact</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>provider</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ip_address</span>: <span style=color:#e6db74>&#34;{{ ansible_host }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;{{ ansible_password }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>username</span>: <span style=color:#e6db74>&#34;{{ ansible_user }}&#34;</span>
</span></span></code></pre></div><h3 id=getting-facts>Getting facts</h3><p>The Palo Alto Network module is not using the <code>gather_facts</code> parameter; instead, it&rsquo;s defining a
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-1-facts.yml title=playbook-1-facts.yml target=_blank rel=noopener>custom task</a>
to retrieve facts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>paloaltonetworks.panos.panos_facts</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>provider</span>: <span style=color:#e6db74>&#34;{{ provider }}&#34;</span>
</span></span></code></pre></div><h3 id=sending-operational-commands>Sending operational commands</h3><p>The module <code>panos_op</code> allows sending commands to the firewall. The module translates the given command into XML and uses the XML API. Some commands can fail so the best way is to specify commands using the XML syntax. The following command is failing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>cmd</span>: <span style=color:#e6db74>&#39;show arp management&#39;</span> <span style=color:#75715e># Fails with &#34;show -&gt; arp has unexpected text.&#34;</span>
</span></span></code></pre></div><p>The following command is working:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>cmd</span>: <span style=color:#e6db74>&#34;&lt;show&gt;&lt;arp&gt;&lt;entry name=&#39;management&#39;/&gt;&lt;/arp&gt;&lt;/show&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>cmd_is_xml</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>The API browser, available on the Firewall using the <code>/api</code> URL can help to find out the right request. The above API is available at <code>/php/rest/browse.php/op::show::arp</code>.</p><p>We used <code>panos_op</code> to get
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-2-get-system-info.yml title=playbook-2-get-system-info.yml target=_blank rel=noopener>system info</a>
and the
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-3-get-arp-table.yml title=playbook-3-get-arp-table.yml target=_blank rel=noopener>ARP table</a>
.</p><p>Because operational commands are sent in the XML format, the output is automatically converted to JSON from the Ansible module. Remember that XML can be converted to JSON/YAML and back, but mind that XML attributes will be usually lost.</p><h3 id=sending-configuration-commands>Sending configuration commands</h3><p>We wrote the
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-4-provisioning.yml title=playbook-4-provisioning.yml target=_blank rel=noopener>fourth playbook</a>
to test configuration commands. There are many configuration commands available from the Ansible module but we are limited to configuring some management interface parameters.</p><p>We discussed a few about how to &ldquo;zero-touch provision&rdquo; a Palo Alto Network firewalls. Even if we didn&rsquo;t test the scenario, we agreed that we could write a working playbook.</p><h3 id=configuration-templating>Configuration templating</h3><p>Even if configuration commands could be used to manage a lot of firewall features, we tested a different approach: configuration templating. Because Palo Alto Network firewalls have the commit feature, in my opinion, this is the best approach.</p><p>My idea is:</p><ul><li>prepare a configuration template (Jinja2);</li><li>build the firewall configuration from the template using an external configuration file (model);</li><li>upload the firewall configuration file and enable it.</li></ul><p>The
<a href=https://github.com/dainok/twitch-sessions/blob/main/S01E05-ansible-with-panw/playbook-5-provisioning-from-file.yml title=playbook-5-provisioning-from-file.yml target=_blank rel=noopener>fifth playbook</a>
implement this approach.</p><p>Pros and cons of this approach:</p><ul><li>the entire firewall configuration can be stored in a CMDB file (pro);</li><li>the firewall configuration is always consistent (pro);</li><li>we can configure almost everything (pro);</li><li>we don&rsquo;t need to make checks before inserting a specific configuration in a running firewall (pro);</li><li>we need to spend a lot of time designing our firewall model (cons).</li></ul><h2 id=programming-the-firewall-using-external-feeds>Programming the firewall using external feeds</h2><p>Many firewalls can read external feeds: the content can be used as a source or destination in access lists. This approach is perfect to allow temporary access. In the
<a href=https://github.com/dainok/twitch-sessions/tree/main/S01E06-automating-dynamic-lists-for-panw-firewalls title=edlprovider target=_blank rel=noopener>last session</a>
we created a small web application using Django.</p><p>The application provides feeds containing IP addresses. Each IP address has an expiration date. Once the IP address is expired, it is removed from the feed.</p><p><a data-fancybox=gallery href=/blog/2022/02/02/automating-palo-alto-networks-firewalls/django-with-panw.webp><img sizes="292 " srcset=/blog/2022/02/02/automating-palo-alto-networks-firewalls/django-with-panw.webp src=/blog/2022/02/02/automating-palo-alto-networks-firewalls/django-with-panw.webp alt="Django application for  Palo Alto Networks firewalls" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><h3 id=installing-django>Installing Django</h3><p>Install Django into a Python environment (see S01E01):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install Django<span style=color:#f92672>==</span>4.0.1
</span></span></code></pre></div><h3 id=creating-the-django-application>Creating the Django application</h3><p>Create the first Django project and an application within it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>django-admin startproject feedapp
</span></span><span style=display:flex><span>cd feedapp
</span></span><span style=display:flex><span>django-admin startapp edlprovider
</span></span><span style=display:flex><span>./manage.py migrate
</span></span></code></pre></div><p>By default, the database is an SQLite file stored under the Django root folder. The app must be loaded in the <code>settings.py</code> file stored in the <code>feedapp</code> folder:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>INSTALLED_APPS = [
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    &#34;edlprovider&#34;,
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>Create the admin user:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.py createsuperuser
</span></span></code></pre></div><h3 id=modeling>Modeling</h3><p>In the simplest version of our application, we can expect that:</p><ul><li>an admin user is adding one or more EDL objects (list of IP addresses);</li><li>an admin user is adding one or more IP addresses to one EDL object;</li><li>possibly an expiration time can be set to each IP address;</li><li>unexpired IP addresses will be available in a text list under a specific, non-guessable, URL.</li></ul><p>In other words, we have two objects:</p><ul><li>EDL with ID, name, URL;</li><li>IP with name, expiration date (optional), associated EDL.</li></ul><p>When the model is complete, we need to update the migration scripts and upgrade the database schema:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.py makemigrations
</span></span><span style=display:flex><span>./manage.py migrate
</span></span></code></pre></div><h3 id=admin-page>Admin page</h3><p>By default, Django provides an admin page for each model. It can be enabled by adding in the <code>admin.py</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>admin.site.register(models.EDL)
</span></span><span style=display:flex><span>admin.site.register(models.IPAddress)
</span></span></code></pre></div><p>Open the Django application using the URL <code>/admin</code>, and add one EDL with at least one IP address.</p><h3 id=printing-edls>Printing EDLs</h3><p>The <code>view.py</code> file is used to serve custom HTTP requests. We need to print the content of each EDL if a GET is requesting the EDL id (slug). The URL is defined in the <code>rrapp/urls.py</code> file.</p><p>All IP addresses linked to a specific EDL are printed in text format if the expiration date is in the future.</p><h3 id=starting-the-server>Starting the server</h3><p>In the <code>settings.py</code> file you can configure Django to serve any client. This is an insecure configuration. Add <code>*</code> to the <code>ALLOWED_HOSTS</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ALLOWED_HOSTS = [&#39;*&#39;]
</span></span></code></pre></div><p>Start the application:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./manage.py runserver 0.0.0.0:8000
</span></span></code></pre></div><p>The Django application is now reachable. Use the <code>/admin</code> URL and log in with the superuser credentials created before.</p><h3 id=using-the-edl-from-a-panw-firewall>Using the EDL from a PANW firewall</h3><p>Once an EDL is populated, it can be used as a source or destination on ACLs.</p><p>EDL can be debugged with the following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>admin@fw&gt; request system external-list stats type ip name EDL1
</span></span><span style=display:flex><span>admin@fw&gt; request system external-list show type ip name EDL1
</span></span><span style=display:flex><span>admin@fw&gt; request system external-list refresh type ip name EDL1
</span></span></code></pre></div><p>Last note: when an IP address is removed from an EDL, the session is not cleared. In other words, the established sessions are maintained, and new sessions are dropped.</p><p>A script should clear sessions related to expired IP addresses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>admin@fw&gt; clear session all filter rule TestEDL1 destination 192.168.28.152
</span></span></code></pre></div><p>Mind also that firewall usually probes URLs every 5 minutes, so the clear command should be executed 5 minutes after the expiration date. The web application should be extended to track requests and if they have been cleared.</p><h2 id=references>References</h2><ul><li><a href=https://github.com/dainok/twitch-sessions/tree/main/S01E05-ansible-with-panw title="Ansible with PANW" target=_blank rel=noopener>Ansible with PANW</a></li><li><a href=https://github.com/dainok/twitch-sessions/tree/main/S01E06-automating-dynamic-lists-for-panw-firewalls title="Automating Dynamic Lists for PANW firewalls" target=_blank rel=noopener>Automating Dynamic Lists for PANW firewalls</a></li><li><a href=https://galaxy.ansible.com/paloaltonetworks/panos title="PAN-OS Ansible Collection" target=_blank rel=noopener>PAN-OS Ansible Collection</a></li><li><a href=https://paloaltonetworks.github.io/pan-os-ansible/ title="PAN-OS Ansible Collection Documentation" target=_blank rel=noopener>PAN-OS Ansible Collection Documentation</a></li><li><a href=http://api-lab.paloaltonetworks.com/ title="PAN-OS XML API Labs with pan-python" target=_blank rel=noopener>PAN-OS XML API Labs with pan-python</a></li><li><a href=https://docs.paloaltonetworks.com/pan-os/10-1/pan-os-admin/policy/use-an-external-dynamic-list-in-policy/external-dynamic-list.html title="External Dynamic List" target=_blank rel=noopener>External Dynamic List</a></li></ul></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>