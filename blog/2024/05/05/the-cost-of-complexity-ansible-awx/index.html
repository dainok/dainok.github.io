<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > The cost of complexity: Ansible AWX</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="For several years now, Ansible AWX has been on my ToDo list. I have always postponed dealing with it due to its complexity, but today I find myself having to tackle it."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="The cost of complexity: Ansible AWX"><meta property="og:description" content="For several years now, Ansible AWX has been on my ToDo list. I have always postponed dealing with it due to its complexity, but today I find myself having to tackle it."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2024/05/05/the-cost-of-complexity-ansible-awx/"><meta property="og:image" content="https://www.adainese.it/images/vendors/ansible.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-05-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-05T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.it/images/vendors/ansible.png"><meta name=twitter:title content="Andrea Dainese > The cost of complexity: Ansible AWX"><meta name=twitter:description content="For several years now, Ansible AWX has been on my ToDo list. I have always postponed dealing with it due to its complexity, but today I find myself having to tackle it."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>The cost of complexity: Ansible AWX</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#awx-operator>AWX Operator</a></li><li><a href=#reboot>Reboot</a></li><li><a href=#ansible-galaxy>Ansible Galaxy</a></li><li><a href=#paramiko-vs-pylibssh>paramiko vs pylibssh</a></li><li><a href=#bastion-host>Bastion host</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2025/11/30/a-practical-cisco-ndo-multi-site-use-case-config-deploy/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/11/30/a-practical-cisco-ndo-multi-site-use-case-config-deploy/>A practical Cisco NDO multi-site use case: config deploy</a><br><i class="fa fa-calendar"></i>
November 30, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/11/23/a-practical-cisco-ndo-multi-site-use-case-building-the-parser/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/11/23/a-practical-cisco-ndo-multi-site-use-case-building-the-parser/>A practical Cisco NDO multi-site use case: building the parser</a><br><i class="fa fa-calendar"></i>
November 23, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/11/22/eve-ng-sw-architecture-and-docker-support/><img class="img-fluid rounded" src=/images/vendors/eve-ng.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/11/22/eve-ng-sw-architecture-and-docker-support/>EVE-NG (SW architecture and docker support)</a><br><i class="fa fa-calendar"></i>
November 22, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/11/16/a-practical-cisco-ndo-multi-site-use-case-data-validation/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/11/16/a-practical-cisco-ndo-multi-site-use-case-data-validation/>A practical Cisco NDO multi-site use case: data validation</a><br><i class="fa fa-calendar"></i>
November 16, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/11/09/a-practical-cisco-ndo-multi-site-use-case-additional-configuration/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/11/09/a-practical-cisco-ndo-multi-site-use-case-additional-configuration/>A practical Cisco NDO multi-site use case: additional configuration</a><br><i class="fa fa-calendar"></i>
November 09, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 170 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 134 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>The cost of complexity: Ansible AWX</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
May 05, 2024</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/automation/ title="All posts under Automation">Automation</a>,
<a href=/categories/infrastructure/ title="All posts under Infrastructure">Infrastructure</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/images/vendors/ansible.webp><img class="img-fluid w-25 rounded shadow float-right" src=/images/vendors/ansible.webp alt="Post cover"></a></div><p>For several years now, <a href=https://github.com/ansible/awx title="Ansible AWX">Ansible AWX</a> has been on my ToDo list. I have always postponed dealing with it due to its complexity, but today I find myself having to tackle it. I knew it would be challenging, but I didn&rsquo;t imagine just how much.</p><p>This post aims to summarize the steps to install a development instance of AWX and discuss the enormous, unnecessary, and harmful complexity that our infrastructures have reached.</p><h2 id=awx-operator>AWX Operator</h2><p>First and foremost, it&rsquo;s essential to note that AWX is available via containers on the <a href=https://kubernetes.io/ title=Kubernetes>Kubernetes</a> platform. My attempts to run the application in standalone mode or as a simple container on <a href=https://www.docker.com/ title=Docker>Docker</a> were futile.</p><p>I chose to prepare an Ubuntu Linux 22.04 VM on which I installed <a href=https://minikube.sigs.k8s.io/docs/ title=Minikube>Minikube</a>. Minikube, in turn, installs a reduced version of <a href=https://kubernetes.io/ title=Kubernetes>Kubernetes</a>.</p><p>To summarize:</p><ul><li>My lab contains a VMware vSphere cluster;</li><li>Within the cluster, there is a virtualized instance of <a href=https://ubuntu.com/ title="Ubuntu Linux">Ubuntu Linux 22.04</a>;</li><li>On the Linux system, a <a href=https://kubernetes.io/ title=Kubernetes>Kubernetes</a> environment is virtualized (created through <a href=https://minikube.sigs.k8s.io/docs/ title=Minikube>Minikube</a>);</li><li>On <a href=https://kubernetes.io/ title=Kubernetes>Kubernetes</a>, we install <a href=https://github.com/ansible/awx title="Ansible AWX">Ansible AWX</a> using the <a href=https://github.com/ansible/awx-operator title="AWX Operator">AWX Operator</a> application.</li></ul><p>For the details of the individual steps, I refer you to the two links by Christopher Hart at the end of the post.</p><p>The reflection I want to make concerns the complexity of the environment necessary to run what is an orchestrator of playbooks. The probability that something will go wrong in the setup is very high, and debugging any problems requires expertise in many, too many, different environments. Not to mention how to update, backup, restore, or design the disaster recovery process for such a solution.</p><h2 id=reboot>Reboot</h2><p>After a few hours of use, I realize that my instance of AWX is no longer working correctly. The reason becomes almost immediately apparent: the disk space of the Ubuntu Linux system was exhausted. I extend the disk space and restart the system&mldr; but AWX doesn&rsquo;t seem to start.</p><p>In order, I verify:</p><ul><li>Docker on Ubuntu Linux;</li><li>Minikube;</li><li>Docker within Kubernetes;</li><li>The AWX containers within Kubernetes.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>minikube status
</span></span><span style=display:flex><span>minikube restart
</span></span><span style=display:flex><span>minikube kubectl -- get pods -A
</span></span><span style=display:flex><span>minikube service list
</span></span><span style=display:flex><span>kubectl logs --namespace<span style=color:#f92672>=</span>awx -p svc/awx-service
</span></span><span style=display:flex><span>kubectl get services --namespace awx
</span></span></code></pre></div><p>After a few minutes, the AWX service responds, but it is not exposed. A few more minutes, and I manage to reach the login page again.</p><h2 id=ansible-galaxy>Ansible Galaxy</h2><p>The playbooks I wrote use the <code>cisco.ios</code> collection, which is installed by default with <a href=https://www.ansible.com/ title=Ansible>Ansible</a>, but it seems not to exist in AWX. I discover that there is a specific format for defining the dependencies of an AWX project. You need to create the <code>collections/requirements.yml</code> file indicating the necessary dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>collections</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cisco.ios</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>version</span>: <span style=color:#ae81ff>8.0.0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>: <span style=color:#ae81ff>https://galaxy.ansible.com</span>
</span></span></code></pre></div><p>I rerun the playbook and move on to the next error.</p><h2 id=paramiko-vs-pylibssh>paramiko vs pylibssh</h2><p>The next error indicates the use of <code>paramiko</code> instead of <code>ansible-pylibssh</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ASK [cisco_ios_system : SETTING FACTS] ****************************************
</span></span><span style=display:flex><span>[WARNING]: ansible-pylibssh not installed, falling back to paramiko
</span></span><span style=display:flex><span>[WARNING]: ansible-pylibssh not installed, falling back to paramiko
</span></span><span style=display:flex><span>ok: [sw1.example.com]
</span></span><span style=display:flex><span>ok: [sw2.example.com]
</span></span><span style=display:flex><span>TASK [cisco_ios_system : CONFIGURING HOSTNAME AND DOMAIN NAME] *****************
</span></span><span style=display:flex><span>fatal: [sw2.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;No existing session&#34;}
</span></span><span style=display:flex><span>fatal: [sw1.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;No existing session&#34;}
</span></span></code></pre></div><p>However, the <code>cisco.ios</code> collection requires the use of <code>ansible-pylibssh</code>, not present by default on Ansible and AWX, which instead use <code>paramiko</code>. With little hope, I force the use of <code>pylibssh</code>, configuring in the inventory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ansible_network_cli_ssh_type</span>: <span style=color:#ae81ff>libssh</span>
</span></span></code></pre></div><p>I rerun the playbook, and indeed the error reports the absence of the library:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>TASK [cisco_ios_system : CONFIGURING HOSTNAME AND DOMAIN NAME] *****************
</span></span><span style=display:flex><span>fatal: [sw1.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;Failed to import the required Python library (ansible-pylibssh) on automation-job-11-m85n8&#39;s Python /usr/bin/python3. Please read the module documentation and install it in the appropriate location. If the required library is installed, but Ansible is using the wrong Python interpreter, please consult the documentation on ansible_python_interpreter&#34;}
</span></span><span style=display:flex><span>fatal: [sw2.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;Failed to import the required Python library (ansible-pylibssh) on automation-job-11-m85n8&#39;s Python /usr/bin/python3. Please read the module documentation and install it in the appropriate location. If the required library is installed, but Ansible is using the wrong Python interpreter, please consult the documentation on ansible_python_interpreter&#34;}
</span></span></code></pre></div><p>The above error also shows us that the playbook is executed from a container created specifically for each execution: <code>automation-job-11-m85n8</code>. Investigating, I discover that the container is created for each job from the image <code>quay.io/ansible/awx-ee</code>. The image is defined on AWX in <code>Administration</code> -> <code>Execution Environment</code>.</p><p>So I need a custom <code>awx-ee</code> image containing the <code>ansible-pylibssh</code> library. After some research, I find that someone has had the same problem as me and has already created an image, although it&rsquo;s a year old. Before embarking on creating a new image, in quick & dirty mode, I decide to use that image to see if I can get a working prototype.</p><p>In <code>Administrator</code> -> <code>Execution Environments</code>, I add a new image as follows:</p><ul><li>Name: <code>AWX EE w pylibssh</code></li><li>Image: <code>quay.io/repository/azzeddineslimani/eev_awx_cisco</code></li><li>Pull: Always pull container before running</li></ul><p>I associate this new image with the playbook, restart, and get a new error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Receptor detail:
</span></span><span style=display:flex><span>Error creating pod: container failed to start, ImagePullBackOff
</span></span></code></pre></div><p>I discover it&rsquo;s a Kubernetes error caused by the inability to download the image. I check manually and indeed see that the image is not present in the docker repository within Kubernetes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>minikube image ls
</span></span></code></pre></div><p>I try the manual way and force the download:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>minikube image pull quay.io/azzeddineslimani/eev_awx_cisco
</span></span></code></pre></div><p>A few minutes, and the image is correctly downloaded.</p><p>I rerun the playbook, but the error is the same.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl logs -f -n awx automation-job-18-gcwfn
</span></span><span style=display:flex><span>Error from server <span style=color:#f92672>(</span>BadRequest<span style=color:#f92672>)</span>: container <span style=color:#e6db74>&#34;worker&#34;</span> in pod <span style=color:#e6db74>&#34;automation-job-18-gcwfn&#34;</span> is waiting to start: trying and failing to pull image
</span></span></code></pre></div><p>The error is mine: I assumed that not specifying the image version would download the latest available (<code>latest</code>), but it is not the case. I correct the URL using <code>quay.io/azzeddineslimani/eev_awx_cisco:latest</code> and rerun the playbook.</p><p>Same error.</p><p>I come across the following description:</p><blockquote><p>If you believe everything is appropriately configured, try pulling the image directly from the command line (using the docker image pull command) with the same values that are specified in your application manifest. If this works, you know the image is accessible, and that the root cause of the problem lies somewhere in Kubernetes. In this case, lack of available resources or networking configuration issues are your most likely culprit.</p></blockquote><p>Since the image is correct, exists, I deduce that the error is application-related. I delete the image reference, recreate it, and reference it to the playbook.</p><p>I rerun the playbook and encounter the next error.</p><h2 id=bastion-host>Bastion host</h2><p>The next error concerns the inaccessibility of devices:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>fatal: [sw1.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;ssh connection failed: ssh connect failed: Timeout connecting to 169.254.1.111&#34;}
</span></span><span style=display:flex><span>fatal: [sw2.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;ssh connection failed: ssh connect failed: Timeout connecting to 169.254.1.112&#34;}
</span></span></code></pre></div><p>The reason is simple: my lab environment involves passing through a bastion host, which requires authentication via key. The solution in an environment without containers would be immediate, but containers have no persistence, nor does the <code>automation</code> container created for each job. The solution is the same as seen for the previous paragraph: I need to create a custom <code>awx-ee</code> image.</p><p>Once again, I go for the quick & dirty way. My goal is to get a working prototype and then figure out how to cleanly resolve the errors I&rsquo;ve encountered.</p><p>I add a route so that the Ubuntu Linux system can directly reach the devices without the need for the bastion host.</p><p>I run the playbook and move on to the new error.</p><h2 id=authentication>Authentication</h2><p>The next error concerns authentication to the devices:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>fatal: [sw1.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;ssh connection failed: Failed to authenticate public key: Access denied for &#39;none&#39;. Authentication that can continue: publickey,keyboard-interactive,password&#34;}
</span></span><span style=display:flex><span>fatal: [sw2.example.com]: FAILED! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;ssh connection failed: Failed to authenticate public key: Access denied for &#39;none&#39;. Authentication that can continue: publickey,keyboard-interactive,password&#34;}
</span></span></code></pre></div><p>Here too, the error is mine: I chose the wrong type of <a href=https://docs.ansible.com/ansible-tower/latest/html/userguide/credentials.html title="Ansible Tower: Credentials">Ansible Tower: Credentials</a>. The <code>Network</code> type is to be used for devices that require a local connection, while the <code>cisco.ios</code> module has been migrated to <code>network_cli</code> mode, which requires the <code>Machine</code> type. I recreate the credentials using the correct type, update the playbook, and rerun it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>PLAY RECAP *********************************************************************
</span></span><span style=display:flex><span>sw1.example.com            : ok=26   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</span></span><span style=display:flex><span>sw2.example.com            : ok=26   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</span></span></code></pre></div><p>Finally, after about 8 hours of work, I get the result.</p><h2 id=conclusions>Conclusions</h2><p>I&rsquo;m definitely getting older, but I also believe I have some good reasons on my side: if to install an orchestrator necessary to automate a series of tasks we have to resort to a complexity like that described in this post, perhaps we are doing something wrong.</p><p>Not only do we have difficulty finding the necessary skills to manage such a system, not only are we ignoring the basic rules that security would impose, but we have no idea how complex applications interact with each other. And we don&rsquo;t even have the tools to understand it anymore.</p><p>Am I exaggerating?</p><p>Perhaps, but for the project I&rsquo;m working on, I need:</p><ul><li>network engineers, who do the low-level design for the involved devices;</li><li>automation engineers, who write automations based on the given requirements;</li><li>Kubernetes specialists who manage the orchestrator for me;</li><li>application specialists (AWX in this specific case) who help me understand if and how I can adapt the orchestrator according to the project&rsquo;s needs;</li><li>gurus who can understand the language of each described figure, creating a single team that speaks and works together. In this specific case, I remember a discussion between a Kubernetes/OpenShift expert and a network expert on the topic of routing. Same word with two completely different meanings.</li></ul><p>Good luck.</p><h2>References</h2><ul><li><a href=https://chrisjhart.com/TLDR-Docker-Ubuntu-2204/ title="Install Docker on Ubuntu 22.04" target=_blank rel=noopener>Install Docker on Ubuntu 22.04</a></li><li><a href=https://chrisjhart.com/TLDR-AWX-Minikube-Ubuntu-2204/ title="Install AWX with Minikube on Ubuntu 22.04" target=_blank rel=noopener>Install AWX with Minikube on Ubuntu 22.04</a></li><li><a href=https://ugurakgul.medium.com/creating-a-custom-execution-environment-for-awx-2a976ab3432f title="Creating a Custom Execution Environment For AWX" target=_blank rel=noopener>Creating a Custom Execution Environment For AWX</a></li><li><a href=https://minikube.sigs.k8s.io/docs/ title=Minikube target=_blank rel=noopener>Minikube</a></li><li><a href=https://kubernetes.io/ title=Kubernetes target=_blank rel=noopener>Kubernetes</a></li><li><a href=https://www.amazon.com/dp/B0D2PF3BHY/ title="Buy Ansible Workbook on Amazon" target=_blank rel=noopener>Buy Ansible Workbook on Amazon</a></li></ul></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>