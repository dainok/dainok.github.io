<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > Palo Alto Firewall as Code</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="It has been about 6 years since the Automate IT² event organized by me and Gabriele Gerbino. During the event, Xavier Homes presented a case that fascinated me. Today we might call it: Firewall as Code."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="Palo Alto Firewall as Code"><meta property="og:description" content="It has been about 6 years since the Automate IT² event organized by me and Gabriele Gerbino. During the event, Xavier Homes presented a case that fascinated me. Today we might call it: Firewall as Code."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2024/06/22/palo-alto-firewall-as-code/"><meta property="og:image" content="https://www.adainese.it/cover.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-22T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.itcover.png"><meta name=twitter:title content="Andrea Dainese > Palo Alto Firewall as Code"><meta name=twitter:description content="It has been about 6 years since the Automate IT² event organized by me and Gabriele Gerbino. During the event, Xavier Homes presented a case that fascinated me. Today we might call it: Firewall as Code."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>Palo Alto Firewall as Code</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#the-process>The Process</a></li><li><a href=#the-model>The Model</a></li><li><a href=#implementation-approach>Implementation Approach</a></li><li><a href=#tools>Tools</a></li><li><a href=#implementation>Implementation</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/12/frameworks-for-projects-with-cisco-aci-and-ndo/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/12/frameworks-for-projects-with-cisco-aci-and-ndo/>Frameworks for Projects with Cisco ACI and NDO</a><br><i class="fa fa-calendar"></i>
October 12, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/05/creating-an-interface-in-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/05/creating-an-interface-in-strata-cloud-manager/>Creating an interface in Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
October 05, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/01/circular-dependencies-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/01/circular-dependencies-with-ndo/>Circular Dependencies with NDO</a><br><i class="fa fa-calendar"></i>
October 01, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/>Modifying an object in Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
September 28, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/>From Single-Site to Multi-Site with NDO</a><br><i class="fa fa-calendar"></i>
September 24, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 162 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 126 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>Palo Alto Firewall as Code</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
June 22, 2024</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/automation/ title="All posts under Automation">Automation</a>,
<a href=/categories/security/ title="All posts under Security">Security</a>,
<a href=/categories/ciso/ title="All posts under CISO">CISO</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/blog/2024/06/22/palo-alto-firewall-as-code/cover.webp><img class="img-fluid w-25 rounded shadow float-right" src=/blog/2024/06/22/palo-alto-firewall-as-code/cover.webp alt="Post cover"></a></div><p>It has been about 6 years since the <a href=https://automateit2.com/ title="Automate IT²">Automate IT²</a> event organized by me and <a href=https://www.linkedin.com/in/gabrielegerbino/ title="Gabriele Gerbino">Gabriele Gerbino</a>. During the event, <a href=https://www.linkedin.com/in/xhoms/ title="Xavier Homes">Xavier Homes</a> presented a case that fascinated me. Today we might call it: Firewall as Code.</p><p>My interest was not just in the elegance of the solution but also in the practical implications for operations and security.</p><p>For several years, I managed firewalls and now, as a consultant, I see many client implementations. All the installations I encounter have the same problems:</p><ul><li>Hundreds of rules;</li><li>Each rule is built based on the perception of the operator who creates it;</li><li>No clear understanding, except for a brief description, of the origin and evolution of the rule;</li><li>Likely obsolete rules remain configured because no one can confirm if they are necessary or not;</li><li>Rules refer to decommissioned or reused systems, thereby introducing undefined risks;</li><li>Rules are grouped and simplified solely to make operations easier (without any security assessment);</li><li>Constant requests to add new rules without fully understanding what an application should or should not do;</li><li>Impossibility to review due to the reasons above and because the rules change continuously;</li><li>Enormous operational time spent managing the firewalls;</li><li>No one can say if the policies comply with any security directives the company should have.</li></ul><p>While there is software intended to solve the above problems, these solutions are often:</p><ul><li>Another patch for poorly designed processes;</li><li>Complicated to use;</li><li>So expensive that they are not economically sustainable for most companies.</li></ul><p>Let&rsquo;s start from scratch by designing a process that addresses the problems described above, from which (and not the other way around) we derive a technology that allows us to manage our firewalls.</p><p>In the example shown, I used Palo Alto Networks firewalls. The reasons for this choice are:</p><ul><li>I am quite familiar with them;</li><li>They have a configuration entirely exportable in text format (XML in particular);</li><li>I can manipulate the configuration file and then apply it entirely at a later stage (commit).</li></ul><p>The approach we will see should be applicable to all firewalls that meet these three properties.</p><h2 id=the-process>The Process</h2><p>The process I want to design is very simple:</p><ol><li>Application managers define the operating rules of their applications in terms of necessary traffic flows;</li><li>Security managers define high-level traffic policies between different security zones, based on a risk assessment;</li><li>Security architects design, implement, and oversee the firewall solutions;</li><li>Automation takes the requirements from (1), applies the constraints defined in (2), generates the rule base, and applies it to the firewalls. The operational activities of the security architects are limited to what is defined in (3).</li></ol><p>Specifically, application managers must define network requirements through files and make them available along with the application&rsquo;s code or documentation (Git would be a good tool, but not the only one). Daily or on request, the automation updates the policies.</p><h2 id=the-model>The Model</h2><p>As always, the modeling phase takes the most time. In the example, I assumed that:</p><ul><li>The definition of services in terms of protocol/port/application is centralized and managed by the security architects. The reason is that choosing the application associated with a specific port requires specific knowledge of the firewall solution.</li><li>The definition of security zones and their relationship with networks is centralized and managed by the security architects. The reason is that the concept of a security zone is linked to network design.</li><li>Settings like logging and security profiles are managed by the security architects.</li><li>Each application&rsquo;s definition is done via two files: <code>networks.yml</code> and <code>rules.yml</code>. The maintenance of both files is the responsibility of the application manager.</li></ul><p>Here&rsquo;s an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># networks.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>WWW</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10.20.1.7</span><span style=color:#ae81ff>/32</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>APP</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10.20.2.15</span><span style=color:#ae81ff>/32</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>DB</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>10.20.2.23</span><span style=color:#ae81ff>/32</span>
</span></span></code></pre></div><p>The above file defines three objects: <code>WWW</code>, <code>APP</code>, <code>DB</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>destination-address</span>: <span style=color:#ae81ff>WWW</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>HTTP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Allow HTTP external traffic to exposed web server.</span>      
</span></span><span style=display:flex><span>  - <span style=color:#f92672>destination-address</span>: <span style=color:#ae81ff>WWW</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>HTTPS</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Allow HTTPS external traffic to exposed web server.</span>      
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source-address</span>: <span style=color:#ae81ff>WWW</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>destination-address</span>: <span style=color:#ae81ff>APP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>HTTPS_8443</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Allow traffic from exposed web server to application server.</span>      
</span></span><span style=display:flex><span>  - <span style=color:#f92672>source-address</span>: <span style=color:#ae81ff>APP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>destination-address</span>: <span style=color:#ae81ff>DB</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>MYSQL</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Allow traffic from application server to database server.</span>      
</span></span></code></pre></div><p>The above file defines the rules for a specific application. Services are defined in the centralized <code>services.yml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>HTTP</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>applications</span>: <span style=color:#ae81ff>web-browsing</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>HTTPS</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>applications</span>: <span style=color:#ae81ff>ssl</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>HTTPS_8443</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>tcp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8443</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>applications</span>: <span style=color:#ae81ff>ssl</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>MYSQL</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>applications</span>: <span style=color:#ae81ff>mysql</span>
</span></span></code></pre></div><p>Security zones are mapped based on the rules defined in the <code>network-zone_mapping.yml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>zones</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>servers</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>internal</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>10.20.2.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dmz</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>internal</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>10.20.1.0</span><span style=color:#ae81ff>/24</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Internet (catch all)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>internet</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>external</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>0.0.0.0</span><span style=color:#ae81ff>/0</span>
</span></span></code></pre></div><h2 id=implementation-approach>Implementation Approach</h2><p>To summarize the key points of the approach:</p><ul><li>Security architects need to be able to configure the firewalls in detail, and it&rsquo;s unthinkable to replicate an interface with all necessary settings;</li><li>Application managers need to be able to abstractly define traffic rules.</li></ul><p>The most practical approach is therefore:</p><ol><li>Read the updated configuration from the firewall;</li><li>Delete all traffic rules and associated objects;</li><li>Regenerate rules and objects from the files described above and add them to the cleaned configuration;</li><li>Validate the configuration;</li><li>Apply the configuration.</li></ol><p>The advantage of this approach is clear: I never have to worry about checking if an object exists, if it is correct, or if it is in the right position. This greatly simplifies the implementation.</p><p>There are, of course, disadvantages or constraints:</p><ul><li>Rules must be written so that order does not matter;</li><li>All rules must be defined by the files described above.</li></ul><p>Exceptions can obviously be made, but each special case will complicate the implementation.</p><h2 id=tools>Tools</h2><p>Once the model is defined, a tool must be chosen to translate the model into an actual configuration. In my evaluation, I focused on:</p><ul><li><a href=https://github.com/aerleon/aerleon title=Aerleon>Aerleon</a> (formerly <a href=https://github.com/google/capirca title="Google Carpica">Google Carpica</a>)</li><li><a href=https://github.com/PaloAltoNetworks/pan-os-python title=pan-os-python>pan-os-python</a>: official libraries developed by Palo Alto Networks</li><li><a href=https://github.com/kevinsteves/pan-python title=pan-python>pan-python</a>: privately developed libraries on which <code>pan-os-python</code> is based (interesting, isn&rsquo;t it?)</li><li><a href=https://docs.paloaltonetworks.com/pan-os/11-1/pan-os-panorama-api/get-started-with-the-pan-os-xml-api title="PAN-OS XML API">PAN-OS XML API</a></li><li><a href=https://docs.paloaltonetworks.com/pan-os/11-1/pan-os-cli-quick-start title="PAN-OS CLI">PAN-OS CLI</a></li></ul><p>After some attempts with the official <code>pan-os-python</code> library, I decided to take a different path because the library configures the firewall object by object, whereas my approach required manipulating the entire configuration file.</p><p>I then explored <code>pan-python</code>, which seemed to do everything needed. However, due to poor documentation, I had to proceed by trial and error. I was almost at the point of writing my own library that directly invoked the native APIs.</p><p>Aerleon is a very interesting solution but did not reach the level of detail I needed. Using the CLI was unnecessary because Palo Alto Networks firewalls are fully manageable via native APIs.</p><h2 id=implementation>Implementation</h2><p>Currently, the automation is implemented in a single Python file that:</p><ol><li>Reads the configuration from the firewall in XML format;</li><li>Reads the UUID and hit count value for each rule;</li><li>Deletes objects and rules;</li><li>Generates new objects and rules, retaining the UUID, and adds them to the XML;</li><li>Performs some compliance checks;</li><li>Sorts the rules from most used to least used;</li><li>Uploads the configuration to the firewall;</li><li>Applies the configuration.</li></ol><p>The integration could be added to a CI/CD pipeline and customized based on needs.</p><p>There are still some things to manage:</p><ul><li>Rules that must have a specific order;</li><li>Security profiles;</li><li>Support for user groups;</li><li>Specific customizations that someone will surely need.</li></ul><p><a data-fancybox=gallery href=/blog/2024/06/22/palo-alto-firewall-as-code/cover.webp><img sizes="1200 1517 " srcset="/blog/2024/06/22/palo-alto-firewall-as-code/cover_huf129837be11827e3579b55f027dcc809_55102_1200x0_resize_q75_h2_box_2.webp /blog/2024/06/22/palo-alto-firewall-as-code/cover.webp" src=/blog/2024/06/22/palo-alto-firewall-as-code/cover.webp alt="Generated firewall rulebase" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><h2 id=conclusions>Conclusions</h2><p>Developing this automation took me about three days of work. Of course, the result is not production-ready but it is a good starting point.</p><p>The benefits of this approach are objective:</p><ul><li>Greatly reduced operational cost;</li><li>Responsibility for the rules transferred to those who know the application;</li><li>Clean configuration;</li><li>Possibility of continuous checks on the formal correctness of the policy;</li><li>Improved performance thanks to the ability to order rules by usage.</li></ul><p>If you think this approach is futuristic, I must reveal that Xavier&rsquo;s talk was based on a real installation at a fairly large international client.</p><h2>References</h2><ul><li><a href=https://automateit2.com/ title="Automate IT²" target=_blank rel=noopener>Automate IT²</a></li><li><a href=https://github.com/aerleon/aerleon title=Aerleon target=_blank rel=noopener>Aerleon</a></li><li><a href=https://github.com/google/capirca title="Google Carpica" target=_blank rel=noopener>Google Carpica</a></li><li><a href=https://github.com/PaloAltoNetworks/pan-os-python title=pan-os-python target=_blank rel=noopener>pan-os-python</a></li><li><a href=https://github.com/kevinsteves/pan-python title=pan-python target=_blank rel=noopener>pan-python</a></li><li><a href=https://docs.paloaltonetworks.com/pan-os/11-1/pan-os-panorama-api/get-started-with-the-pan-os-xml-api title="PAN-OS XML API" target=_blank rel=noopener>PAN-OS XML API</a></li><li><a href=https://docs.paloaltonetworks.com/pan-os/11-1/pan-os-cli-quick-start title="PAN-OS CLI" target=_blank rel=noopener>PAN-OS CLI</a></li></ul></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>