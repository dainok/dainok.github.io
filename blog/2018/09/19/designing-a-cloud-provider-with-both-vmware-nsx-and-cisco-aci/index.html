<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > Designing a cloud provider with both VMware NSX and Cisco ACI</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="A few months ago I had a chat with a customer about IAAS. The customer wanted to change its business model from an internal ICT only, to an IAAS style ICT, for both internal and external users."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="Designing a cloud provider with both VMware NSX and Cisco ACI"><meta property="og:description" content="A few months ago I had a chat with a customer about IAAS. The customer wanted to change its business model from an internal ICT only, to an IAAS style ICT, for both internal and external users."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/"><meta property="og:image" content="https://www.adainese.it/multi-dc-2.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2018-09-19T00:00:00+00:00"><meta property="article:modified_time" content="2018-09-19T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.itmulti-dc-2.png"><meta name=twitter:title content="Andrea Dainese > Designing a cloud provider with both VMware NSX and Cisco ACI"><meta name=twitter:description content="A few months ago I had a chat with a customer about IAAS. The customer wanted to change its business model from an internal ICT only, to an IAAS style ICT, for both internal and external users."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>Designing a cloud provider with both VMware NSX and Cisco ACI</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#the-very-high-level-design-hld>The very High-Level Design (HLD)</a></li><li><a href=#vmware-nsx>VMware NSX</a><ul><li><a href=#distributed-firewall-with-vmware-nsx>Distributed firewall with VMware NSX</a></li><li><a href=#availability-zones-with-vmware-nsx>Availability zones with VMware NSX</a></li><li><a href=#backup-and-disaster-recovery>Backup and Disaster Recovery</a></li><li><a href=#onboarding>Onboarding</a></li><li><a href=#physical-devices-attached-to-vmware-nsx>Physical devices attached to VMware NSX</a></li><li><a href=#conclusion-for-the-vmware-design>Conclusion for the VMware design</a></li></ul></li><li><a href=#cisco-aci>Cisco ACI</a><ul><li><a href=#distributed-firewall-with-cisco-aci>Distributed firewall with Cisco ACI</a></li><li><a href=#availability-zones-with-cisco-aci>Availability zones with Cisco ACI</a></li><li><a href=#backup-disaster-recovery-and-onboarding>Backup, Disaster Recovery, and Onboarding</a></li><li><a href=#physical-devices-attached-to-cisco-aci>Physical devices attached to Cisco ACI</a></li><li><a href=#conclusion-for-the-cisco-aci-design>Conclusion for the Cisco ACI design</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2025/10/01/circular-dependencies-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/10/01/circular-dependencies-with-ndo/>Circular Dependencies with NDO</a><br><i class="fa fa-calendar"></i>
October 01, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/28/modifying-an-object-in-strata-cloud-manager/>Modifying an object in Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
September 28, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/24/from-single-site-to-multi-site-with-ndo/>From Single-Site to Multi-Site with NDO</a><br><i class="fa fa-calendar"></i>
September 24, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/21/retrieving-firewall-interfaces-with-strata-cloud-manager/><img class="img-fluid rounded" src=/images/vendors/paloalto.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/21/retrieving-firewall-interfaces-with-strata-cloud-manager/>Retrieving firewall interfaces with Strata Cloud Manager</a><br><i class="fa fa-calendar"></i>
September 21, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/09/20/eve-ng-linux-vm-ssh-troubleshooting/><img class="img-fluid rounded" src=/images/vendors/eve-ng.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/09/20/eve-ng-linux-vm-ssh-troubleshooting/>EVE-NG Linux VM SSH troubleshooting</a><br><i class="fa fa-calendar"></i>
September 20, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 159 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 123 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>Designing a cloud provider with both VMware NSX and Cisco ACI</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
September 19, 2018</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/infrastructure/ title="All posts under Infrastructure">Infrastructure</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2.webp><img class="img-fluid w-25 rounded shadow float-right" src=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2.webp alt="Post cover"></a></div><p>A few months ago I had a chat with a customer about IAAS. The customer wanted to change its business model from an internal ICT only, to an IAAS style ICT, for both internal and external users.</p><p>The prerequisites from the customer were:</p><ul><li>infrastructure distributed into two data centers, 30km between them;</li><li>able to transparent move workload between the two data centers;</li><li>users should be able to do everything via a self-service portal.</li></ul><p>Of course, the above prerequisites are not enough. Customers often don&rsquo;t know what they want. After an additional chat, we agreed on:</p><ul><li>High Availability Zones: each data center must be designed to be completely independent. Data centers are interconnected with redundant 100GbE.</li><li>Mobility: workload could be transparently moved from one data center to the other one. Tenants usually run on one data center only, except when moving. Latency is accepted because that&rsquo;s considered a temporary and planned event. The idea is: that users will get space in a data center, but they can be moved to the other one. Users cannot buy space in both data centers to deliver distributed applications.</li><li>Physical devices: physical devices can be added to specific tenants. Examples are: ISP routers, Oracle Exadata, IBM AS 400, HSMs&mldr;</li><li>Connectivity: each tenant can be reached from the external via remote access VPN and site-to-site VPN. Also, external connectivity could be used, like MPLS/VPLS/&mldr; Each tenant can rent some public IP addresses, or just use the assigned ones. Tenants could be interconnected together if they have non-overlapping IP addresses.</li><li>Storage: fiber-channel storage is not stretched between data centers.</li><li>Self Service Portal: users won&rsquo;t be able to do &ldquo;everything&rdquo; but only a set of defined actions.</li><li>Backup and Disaster Recovery: users can buy backup (BaaS) and/or disaster recovery (DRaaS) features on a per VM basis.</li></ul><h2 id=the-very-high-level-design-hld>The very High-Level Design (HLD)</h2><p>The choice of technology should not be discussed at this level, but because every technology has its own prerequisites/features/limitations/peculiarities, we cannot go far without making assumptions.</p><p>The &ldquo;mobility&rdquo; prerequisite is one of the most stringent: moving workloads without disruption (vMotion), means that LANs must be stretched. To stretch LANs, one of the following can be used:</p><ul><li>standard VXLAN</li><li>Cisco ACI</li><li>VMware NSX</li></ul><p>This post wants to focus on both VMware NSX and Cisco ACI, so the standard VXLAN will not be discussed. But the step between standard VLAN and Cisco ACI or VMware NSX is short.</p><p>Let&rsquo;s start to design a big picture:</p><p><a data-fancybox=gallery href=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-1.webp><img sizes="800 943 " srcset="/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-1_hu29925ce964b4a7382caab7214b9836dc_18258_800x0_resize_q75_h2_box_2.webp /blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-1.webp" src=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-1.webp alt="Stretched DC - High Level Design" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Each data center is connected to the Internet using one or more ISP, announcing via BGP the same prefixes from the border routers. The border routers are connected to the inside routers and then to a distributed router.</p><p>Each tenant is isolated by a firewall, connected to the distributed router.</p><p>The diagram is inspired by VMware NSX, so let&rsquo;s start to discuss it in detail.</p><h2 id=vmware-nsx>VMware NSX</h2><p>Let&rsquo;s see again the diagram:</p><p><a data-fancybox=gallery href=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2.webp><img sizes="800 943 " srcset="/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2_hu4dcc601d5a751d51a33f9dbe4a5e1f65_41162_800x0_resize_q75_h2_box_2.webp /blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2.webp" src=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-2.webp alt="Stretched DC - High Level Design" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Each border router is connected to one or more ISP routers. Both border routers are announcing the same prefixes with the same AS. In other ways, from the Internet, both data centers are seen as single data centers with two independent exits.</p><p>Border routers will announce also users&rsquo; prefixes directly. Because of NSX limitations (discussed below), BGP peering between tenants and border routers is not permitted.</p><p>Both border routers are also running OSPF, each one peering with an edge router. An edge router (in the NSX world) is a clustered VM acting as a router with some additional features like NAT, firewall, load balancer, IPSec concentrator&mldr;</p><p>In this design, both edge routers are just routers, nothing more.</p><p>Both edge routers are peering (OSPF) with a distributed logical router (DLR). A DLR is a router stretched on one or more physical servers running ESXi. On the other side, the DLR is connected to a stretched network.</p><p>Each tenant has its gateway, implemented by a non-VMware firewall.</p><p>Let&rsquo;s now discuss some VMware NSX limits and the above design choices. Mind that limits can now be changed, so feel free to add your opinion by commenting on this post.</p><ul><li>The edge routers cannot be automatically moved (vMotion) between data centers: in other words, a workload cannot be moved from DC1 to DC2 without manual intervention. It&rsquo;s still possible to destroy a cluster of edge routers and recreate it in the other DC, using the old configuration, but obviously, this is a disruptive approach. Using non-VMware clustered firewalls allows moving one node at a time. Edge firewalls can also offer remote access VPNs, site-to-site IPSec VPNs&mldr; Because the firewall could be moved to the other data center without changing any IP address, the &ldquo;outside&rdquo; network must be stretched between data centers.</li><li>The DLR cannot run OSPF facing the firewalls, so static routing is the only option. Each firewall uses the DLR as a default gateway, and the DLR forward packets destined to the public IP address assigned to each tenant. Also, the DLR cannot peer with border routers directly. That&rsquo;s why edge routers are used between DLR and border routers.</li><li>Because the smaller network that can be announced to Interned is a /24 network, we can assume that more tenants could share the same /24 network. In this case, we should try to run all those tenants in the same DC. The nearest border router will announce a more specific network so all traffic will enter from the right link.</li></ul><p><a data-fancybox=gallery href=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-3.webp><img sizes="800 933 " srcset="/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-3_hud9d7082f83f13585d6d462432a34c3a1_42084_800x0_resize_q75_h2_box_2.webp /blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-3.webp" src=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-3.webp alt="Stretched DC - High Level Designn" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><h3 id=distributed-firewall-with-vmware-nsx>Distributed firewall with VMware NSX</h3><p>VMware NSX provides a distributed firewall to implement micro-segmentation. It sounds great, but the distributed firewall policy is one, shared by all tenants. In a multi-tenant environment, having a single policy is not a great idea, because every user has specific needs, and the policy cannot grow forever.</p><p>The distributed firewall wasn&rsquo;t included in the feature list, but I think that it is still a nice to have feature. How can we adapt a single policy firewall to a multi-tenant environment?</p><p>We could use tags. Each VM can be tagged and get specific firewall rules.</p><p>Assume for example the following tag:</p><ul><li>server_HTTP</li><li>server_HTTP_Proxy</li><li>client_HTTP_Proxy</li><li>allow_any</li></ul><p>We can write a policy like the following:</p><ul><li>VMs tagged with allow_any will receive any traffic.</li><li>VMs tagged with server_HTTP will receive HTTP connections.</li><li>VMs tagged with server_HTTP_Proxy will receive connections from client_HTTP_Proxy VMs only.</li></ul><p>In this scenario, referred to distributed firewall only, not to the edge firewall, each user knows how the policies are, and tagging the VMs can honor or bypass the firewall.</p><h3 id=availability-zones-with-vmware-nsx>Availability zones with VMware NSX</h3><p>Because one of the prerequisites is the independence of data centers, we must design the infrastructure to be alive even if an entire data center is lost.</p><p>Please remind that users will be able to run VMs only from one data center at a time. Enabling users to run VMs from both data centers is not so difficult, but that&rsquo;s not part of the prerequisites.</p><p>In the VMware NSX world we have:</p><ul><li>NSX Manager: it&rsquo;s the management plane for the network. Each NSX manager is bound to a single vCenter.</li><li>NSX Controllers: they are the control plane for the network. Three controllers must exist, two must be alive. If one or no controllers are alive, all VMs &ldquo;should&rdquo; run fine if nothing changes (i.e. no VMotion, no power on&mldr;).</li><li>vCenter</li><li>PSC</li><li>Active Director</li><li>vCloud Director / vRealize Automation</li><li>&mldr;</li></ul><p>Because we need two independent data centers, we need one NSX Manager and three NSX Controller per data center. In this configuration, we must be sure we can move (vMotion) VMs between data centers. In other words, we must be able to move VMs between:</p><ul><li>vCenters (that&rsquo;s fine)</li><li>vCloud Director / vRealize Automation (probably we cannot do that, the best option we have is a disruptive export and import).</li></ul><p>Moreover, we have to define virtual networks as universal. In previous vCloud Director and vRealize Automation versions, users cannot create a universal virtual network. The universal virtual network must be manually created by an administrator.</p><p>If we relax the prerequisite we can have a single stretched infrastructure, with one NSX Manager, three NSX Controllers, and one vCenter. In this case, VMs can be moved without issues but we must consider how to recover from a data center loss of all unique infrastructure VMs (NSX Manager, NSX Controllers, vCenter&mldr;).</p><p>To be more specific, one data center will run two NSX Controllers, the other one will run just one NSX Controller. If the first data center is lost, the NSX Controllers cluster will lose the quorum. At this time, one NSX Controller must be manually redeployed in the surviving data center.</p><h3 id=backup-and-disaster-recovery>Backup and Disaster Recovery</h3><p>Backup VMs and mirroring them into the remote data center is not too difficult. The hardest part is to restore a backup or activate the VM in the remote data center.</p><p>As I mentioned before, VM could be imported into vCloud Directory / vRealize Automation, but deep tests must be run to check if everything is going fine or not. I&rsquo;m referring especially to tags, networks, service portal accounting&mldr;</p><h3 id=onboarding>Onboarding</h3><p>Onboarding service is usually omitted from many designs. As an architect, I can say that this is the most critical part for many users: how to migrate a physical and legacy data center to a cloud provider with minimal disruption? I should mention also that many enterprises don&rsquo;t know what is running in their data centers, and often they don&rsquo;t have the skills to plan a move. This can be a business opportunity and an enabler for the IaaS service.</p><p>Referring to VMware, there is a lot of good software like Veeam, Zerto, and so on. All of them have cost, features, and compatibility lists.</p><h3 id=physical-devices-attached-to-vmware-nsx>Physical devices attached to VMware NSX</h3><p>Last but not least, VMware NSX allows extending L2 networks to a physical domain. High availability and convergence timers must be tested to be sure they are compatible with SLA.</p><p>Even if this works fine, it seems to me they are not easy to maintain if the number increases a lot. Moreover, they probably must be manually configured because they are not part of the default vCloud Director / vRealize Automation scripts.</p><h3 id=conclusion-for-the-vmware-design>Conclusion for the VMware design</h3><p>I hope you know understand why this design is closely related to technological choice. If running the infrastructure can be more or less vendor-independent, when we add service portal, backup, disaster recovery, and onboarding&mldr; we must evaluate much software and check if and how they can work together.</p><p>Also, deep customization can be an issue: if we develop scripts for any single action we need to give to users, what can we assure that all scripts will work after a release upgrade?</p><h2 id=cisco-aci>Cisco ACI</h2><p>Cisco ACI completely split the fabric configuration from the tenant configuration. Once the fabric has been deployed, each tenant can get its contracts, policies, and so on.</p><p>If VMware has an edge gateway included (not used, however), Cisco ACI has no way to NAT addresses.</p><p>Because of the VMware NSX (see above) and Cisco ACI limitations, the design is pretty similar:</p><p><a data-fancybox=gallery href=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-4.webp><img sizes="800 943 " srcset="/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-4_huea85e5ffc6bc8e2e2231ae56a17be4b2_35216_800x0_resize_q75_h2_box_2.webp /blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-4.webp" src=/blog/2018/09/19/designing-a-cloud-provider-with-both-vmware-nsx-and-cisco-aci/multi-dc-4.webp alt="Stretched DC - High Level Designn" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>With Cisco ACI border routers can now peer with tenants also, so users can announce their prefixes by themselves.</p><p>The edge routers are not needed anymore because ACI can peer with external routers directly. With this design, customer can announce their prefixes directly, but the border router must be configured admin transit AS for traffic sourced or destined to the users.</p><p>Because Cisco ACI cannot NAT IP addresses, a gateway for each tenant is needed. Virtual or physical firewalls can be used, as we discussed before in the VMware NSX paragraph.</p><p>If the infrastructure is relatively easy to design, the most critical part is once again related to the software: what should we use to virtualize VMs, implement a service portal&mldr;</p><p>Once again VMware&rsquo;s suite is a good choice, but we can also use OpenStack, OpenNebula, CloudStack&mldr;</p><p>If a 100% VMware suite can work mostly out of the box, we probably won&rsquo;t see a CloudStack + Cisco ACI service portal ready to be used.</p><h3 id=distributed-firewall-with-cisco-aci>Distributed firewall with Cisco ACI</h3><p>If the VMware NSX distributed firewall has a single policy, with Cisco ACI each tenant gets its own separated rules.</p><h3 id=availability-zones-with-cisco-aci>Availability zones with Cisco ACI</h3><p>To fully satisfy the prerequisites, a multi-site fabric must be deployed, with three APIC controllers per site.</p><p>On the top, a Cisco ACI Multi-Site policy manager can be deployed to manage policies on both data centers from one location only. Of course, the policy manager must be recovered if one site goes completely offline.</p><p>If we relax the prerequisite we can deploy a multi-pod fabric. Because each fabric must have at least two running controllers (I&rsquo;m not discussing here how a five controller fabric works), once again one data center will get one controller only.</p><p>But with Cisco ACI, the controller is the management plane. The fabric can work fine even without controllers. And we can add a fourth APIC with the standby role (I guess it&rsquo;s still a manual procedure turning it from standby to active).</p><p>If only one controller exists, the management can be read-only.</p><h3 id=backup-disaster-recovery-and-onboarding>Backup, Disaster Recovery, and Onboarding</h3><p>We already discussed these topics in the VMware part. More or less with Cisco ACI, all the above considerations are still valid, but because Cisco is not providing a full suite, more development is probably required. That&rsquo;s not necessarily a bad thing.</p><h3 id=physical-devices-attached-to-cisco-aci>Physical devices attached to Cisco ACI</h3><p>If interconnecting physical devices to a VMware NSX environment is an &ldquo;exception&rdquo; to the virtual world, Cisco ACI is entirely part of the game. In other words, the number of physical devices can increase a lot without any issue.</p><h3 id=conclusion-for-the-cisco-aci-design>Conclusion for the Cisco ACI design</h3><p>If VMware offers a more complete suite to cover this design case, Cisco ACI offers a more flexible infrastructure without any additional software.</p><p>Both solutions have strong limits, and both require to develop much integration.</p><h2 id=conclusions>Conclusions</h2><p>I wrote this post to share ideas and experiences made in the last few years. It cannot be completed and it probably is already outdated. Anyway, it should give you some details on where to start.</p><p>Today there are no out-of-the-box solutions for this case, so more prerequisites should be relaxed. My opinion is that with a 100% virtual world, VMware is maybe the best solution nowadays. But with an important part of physical servers or devices, Cisco ACI is more flexible.</p></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>