<!doctype html><html lang=en><head><meta name=google-site-verification content="NTPifZ1gNpp6HSoC60ErvHiUUor86ZXg4yHtlpk9lwU"><title>Andrea Dainese > Cisco Wide Area Application Services system (WAAS/WAVE/WAE)</title><meta charset=utf-8><meta name=author content="Andrea Dainese"><meta name=description content="The Cisco WAAS system consists of a set of devices that work together to optimize TCP network traffic. There are two types of devices that run WAAS software:
Cisco Wide Area Application Engine (WAE) Cisco Wide Area Virtualization Engine (WAVE) WAVE appliances implement virtualization: virtual blades can run one or more virtualized OSes within the WAVE appliance."><meta name=generator content="Hugo 0.115.3"><meta name=“robots” content="“noarchive”"><meta name=“robots” content="“notranslate”"><meta name=robots content="noimageindex"><meta property="og:title" content="Cisco Wide Area Application Services system (WAAS/WAVE/WAE)"><meta property="og:description" content="The Cisco WAAS system consists of a set of devices that work together to optimize TCP network traffic. There are two types of devices that run WAAS software:
Cisco Wide Area Application Engine (WAE) Cisco Wide Area Virtualization Engine (WAVE) WAVE appliances implement virtualization: virtual blades can run one or more virtualized OSes within the WAVE appliance."><meta property="og:type" content="article"><meta property="og:url" content="https://www.adainese.it/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/"><meta property="og:image" content="https://www.adainese.it/topology.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2013-08-27T00:00:00+00:00"><meta property="article:modified_time" content="2013-08-27T00:00:00+00:00"><meta property="og:site_name" content="Andrea Dainese"><meta name=twitter:card content="summary"><meta name=twitter:site content="@adainese"><meta name=twitter:image content="https://www.adainese.ittopology.png"><meta name=twitter:title content="Andrea Dainese > Cisco Wide Area Application Services system (WAAS/WAVE/WAE)"><meta name=twitter:description content="The Cisco WAAS system consists of a set of devices that work together to optimize TCP network traffic. There are two types of devices that run WAAS software:
Cisco Wide Area Application Engine (WAE) Cisco Wide Area Virtualization Engine (WAVE) WAVE appliances implement virtualization: virtual blades can run one or more virtualized OSes within the WAVE appliance."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml title="RSS Feed for blog" href=/blog/index.xml><link rel=dns-prefetch href=https://www.googletagmanager.com><link href=https://www.googletagmanager.com rel=preconnect crossorigin><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=stylesheet type=text/css href=/plugins/fontawesome/css/all.min.css><link rel=stylesheet type=text/css href=/plugins/fancybox/jquery.fancybox.min.css><link rel=stylesheet type=text/css href=/fonts/opensans/opensans.css><link rel=stylesheet href=/css/style.min.db8a68dfac8ad6ed301e5f04872a83daee269833ef371fd9ec9475b745de14e5.css integrity="sha256-24po36yK1u0wHl8EhyqD2u4mmDPvNx/Z7JR1t0XeFOU="><link rel=stylesheet href=/css/print.min.a3802e6b39df8780c4980151b47550b34687a140e148c71342fb463b5322e6b1.css media=print integrity="sha256-o4Auaznfh4DEmAFRtHVQs0aHoUDhSMcTQvtGO1Mi5rE="></head><body><button type=button class="mobile-nav-toggle d-lg-none" aria-label="Toggle navigation"><i class="fas fa-bars"></i></button><header id=header class=fixed-top><div class="container d-flex"><div class="logo mr-auto"><h1><a href=/#><span>Andrea</span> Dainese</a></h1></div><nav class="nav-menu d-none d-lg-block"><ul><li><a href=/#>Home</a></li><li><a href=/#about>About</a></li><li class=active><a href=/blog>Blog</a></li><li><a href=/categories>Categories</a></li><li><a href=https://www.patreon.com/adainese target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><form class="form-inline ml-2" action=/search><div class="input-group mb-3"><input id=search-query type=text class=form-control placeholder=Search... name=s aria-label="Search within the website" aria-describedby=basic-addon2><div class=input-group-append><button class="btn btn-outline-primary" type=submit aria-label=Search>
<i class="fa fa-search"></i></button></div></div></form></li></ul></nav></div></header><div id=page-header><div class=home-overlay></div><div class=container><div class=row><div class=col-12><div class="page-header-size text-center"><h1>Cisco Wide Area Application Services system (WAAS/WAVE/WAE)</h1></div></div></div></div></div><main id=main><div class=blogpost-single><div class=container><div class=row><div class="col-xs-12 col-sm-12 col-md-4 d-print-none"><div class=blogpost-nav><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Table of contents</h4><div class=toce><nav id=TableOfContents><ul><li><a href=#why-a-wan-optimizator>Why a WAN optimizator</a></li><li><a href=#waas-auto-discovery>WAAS Auto discovery</a><ul><li><a href=#waas-through-firewall-cisco-asa>WAAS through Firewall (Cisco ASA)</a></li></ul></li><li><a href=#inline>Inline</a></li><li><a href=#wccp>WCCP</a><ul><li><a href=#ha-and-scaling-out-using-wccp>HA and scaling out using WCCP</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Latest posts</h4><div class=recent-post><div class=recent-post-img><a href=/blog/2026/01/18/pagination-with-cisco-aci/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2026/01/18/pagination-with-cisco-aci/>Pagination with Cisco ACI</a><br><i class="fa fa-calendar"></i>
January 18, 2026</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2026/01/11/filtering-cisco-api-output/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2026/01/11/filtering-cisco-api-output/>Filtering Cisco API Output</a><br><i class="fa fa-calendar"></i>
January 11, 2026</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2026/01/04/finding-cisco-aci-classes-with-visore/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2026/01/04/finding-cisco-aci-classes-with-visore/>Finding Cisco ACI Classes with Visore</a><br><i class="fa fa-calendar"></i>
January 04, 2026</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/12/28/cisco-aci-classes/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/12/28/cisco-aci-classes/>Cisco ACI Classes</a><br><i class="fa fa-calendar"></i>
December 28, 2025</p></div></div><div class=recent-post><div class=recent-post-img><a href=/blog/2025/12/21/first-approach-to-cisco-aci-apis/><img class="img-fluid rounded" src=/images/vendors/cisco.webp alt="Post cover"></a></div><div class=recent-post-content><p><a href=/blog/2025/12/21/first-approach-to-cisco-aci-apis/>First Approach to Cisco ACI APIs</a><br><i class="fa fa-calendar"></i>
December 21, 2025</p></div></div></div></div><div class="d-none d-md-block"><div class=blogpost-nav-content><h4>Categories</h4><div class=recent-post><div class=recent-post-img><a href=/categories/automation><img class="img-fluid rounded" src=/images/categories/automation.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/automation>Automation</a><br><i class="fa fa-blog"></i> 177 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/learning-paths><img class="img-fluid rounded" src=/images/categories/learning-paths.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/learning-paths>Learning paths</a><br><i class="fa fa-blog"></i> 141 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ciso><img class="img-fluid rounded" src=/images/categories/ciso.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ciso>CISO</a><br><i class="fa fa-blog"></i> 23 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/personal-security><img class="img-fluid rounded" src=/images/categories/personal-security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/personal-security>Personal Security</a><br><i class="fa fa-blog"></i> 22 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/security><img class="img-fluid rounded" src=/images/categories/security.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/security>Security</a><br><i class="fa fa-blog"></i> 20 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/notes><img class="img-fluid rounded" src=/images/categories/notes.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/notes>Notes</a><br><i class="fa fa-blog"></i> 19 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/infrastructure><img class="img-fluid rounded" src=/images/categories/infrastructure.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/infrastructure>Infrastructure</a><br><i class="fa fa-blog"></i> 12 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/ot-ics><img class="img-fluid rounded" src=/images/categories/ot-ics.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/ot-ics>OT/ICS</a><br><i class="fa fa-blog"></i> 5 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/books><img class="img-fluid rounded" src=/images/categories/books.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/books>Books</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/unetlab><img class="img-fluid rounded" src=/images/categories/unetlab.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/unetlab>UNetLab</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/writeup><img class="img-fluid rounded" src=/images/categories/writeup.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/writeup>Write-up</a><br><i class="fa fa-blog"></i> 3 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/osint><img class="img-fluid rounded" src=/images/categories/osint.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/osint>OSInt</a><br><i class="fa fa-blog"></i> 2 posts</p></div></div><div class=recent-post><div class=recent-post-img><a href=/categories/life><img class="img-fluid rounded" src=/images/categories/life.webp alt="Category cover"></a></div><div class=recent-post-content><p><a href=/categories/life>My life</a><br><i class="fa fa-blog"></i> 1 posts</p></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-8 blogpost-container"><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><article><div class=blogpost-single-content><h2>Cisco Wide Area Application Services system (WAAS/WAVE/WAE)</h2><div class=blogpost-single-meta><div><i class="fa fa-user"></i> Andrea Dainese</div><div><i class="fa fa-calendar"></i>
August 27, 2013</div><div class=tag-meta><i class="fa fa-folder"></i>
<a href=/categories/infrastructure/ title="All posts under Infrastructure">Infrastructure</a></div></div><div class=entry-content><div><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology.webp><img class="img-fluid w-25 rounded shadow float-right" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology.webp alt="Post cover"></a></div><p>The Cisco WAAS system consists of a set of devices that work together to optimize TCP network traffic. There are two types of devices that run WAAS software:</p><ul><li>Cisco Wide Area Application Engine (WAE)</li><li>Cisco Wide Area Virtualization Engine (WAVE)</li></ul><p>WAVE appliances implement virtualization: virtual blades can run one or more virtualized OSes within the WAVE appliance. For example, WAVE-574 can run Microsoft Windows services such as Print Services, Active Directory Services, DNS, and DHCP services.
The Cisco WAE-674 Wide Area Application Engine is the only branch-office appliance from the Cisco WAE platform that offers virtual blade capability. Other WAE models cannot virtualize an external OS.</p><h2 id=why-a-wan-optimizator>Why a WAN optimizator</h2><p>A WAN optimizator is not just a data compressor. It optimizes data transmission over a media with lower bandwidth and higher latency. A Cisco WAAS includes the following key elements:</p><ul><li>Data Redundancy Elimination (DRE): it is a sort of data deduplication that uses disk and memory to store redundant data.</li><li>Persistent LZ Compression (PLZ): packets are compressed before they are sent over the WAN link.</li><li>Transport Flow Optimization (TFO): TFO is a series of TCP optimizations that enhance performance when a high latency media is used. Examples of TCP optimizations are:<ul><li>use large initial windows</li><li>selective acknowledge</li><li>window scaling</li><li>large buffer</li><li>advanced congestion avoidance algorithms</li></ul></li></ul><p>But under real cases how WAAS behave?</p><p>Now Cisco WAAS appliances are under the Data Center Business Unit, and the reason is simple: most of the TCP WAN traffic is Data Center related, and the Data Center traffic is the most optimizable.</p><p>Suppose two data centers replicate each other over a WAN line. Both data centers run VMware, and Oracle over NetApp storage:</p><ul><li>Replication: NetApp Snapmirror is uncompressed;</li><li>SQL: Oracle archive transport (over 1521 TCP port, used also for querying the database) is uncompressed;</li><li>Other traffic (Web, CIFS, email, other file transfer types, &mldr;)</li></ul><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/traffic-distribution.webp><img sizes="464 " srcset=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/traffic-distribution.webp src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/traffic-distribution.webp alt="Traffic Distribution" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Above traffic is compressed with the following performances:</p><ul><li>Replication Traffic (NetApp Snapmirror) is reduced by 83%: the Replication traffic running over the WAN is 17% of the original traffic!</li><li>SQL (Oracle archive transport) is reduced by 70%: the SQL traffic running over the WAN is 30% of the original traffic!</li><li>Teradata replication traffic using FTP is reduced by 75%!</li></ul><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/best-compressed-protocols.webp><img sizes="800 937 " srcset="/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/best-compressed-protocols_hu47a9cbc6e5d051d504f9b1496241487d_16910_800x0_resize_q75_h2_box_2.webp /blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/best-compressed-protocols.webp" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/best-compressed-protocols.webp alt="WAAS best compressed protocols" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>During the tests, 2TB were entered into the WAE and only 580GB was run over the WAN line. This means a 73% reduction!</p><h2 id=waas-auto-discovery>WAAS Auto discovery</h2><p>In the following topology, only traffic between Site A and Site C must be optimized, traffic from and to Site B cannot be optimized because there is no WAE appliance there:</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology.webp><img sizes="500 519 " srcset="/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology_hu83ef0ad34b60457612f6f97239639cbc_8680_500x0_resize_q75_h2_box_2.webp /blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology.webp" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/topology.webp alt="WAAS topology" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Let&rsquo;s suppose a communication initiated by Site A to Site C:</p><ul><li>Site A sends an SYN packet to Site C: the WAE in Site A sets the TCP option 0x21.</li><li>WAE in Site B receives the SYN packet and sees that this communication can be optimized: the TCP option 0x21 is removed and the SYN packet reaches Site C.</li><li>Site C sends an SYN/ACK packet back to Site A: the WAE in Site C shifts SYN SEQ by 2 billion.</li><li>WAE in Site A receives the SYN/ACK packet and recognizes that this connection can be fully optimized. The correct SYN SEQ is restored and the packet reaches Site A.</li><li>This particular TCP connection can now be optimized because there is an end-to-end WAE connection.</li></ul><h3 id=waas-through-firewall-cisco-asa>WAAS through Firewall (Cisco ASA)</h3><p>If packets flow through a Firewall and unknown TCP options are removed (0x21 is an unknown TCP option), then WAAS Auto-Discovery mechanism will fail and traffic won&rsquo;t be optimized. On the latest Cisco ASA a WAAS inspect rule must be activated:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>policy-map global_policy
</span></span><span style=display:flex><span>class inspection_default
</span></span><span style=display:flex><span>inspect waas
</span></span></code></pre></div><p>Checkpoint Firewalls should not be a problem, other firewalls should be checked.</p><h2 id=inline>Inline</h2><p>Cisco WAE/WAVE can be configured using an inline adapter or WCCP protocol. The inline adapter is the simplest method: just put the appliance between the WAN and the router, and all traffic flowing from and to the WAN will be optimized.</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-simple.webp><img sizes="500 548 " srcset="/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-simple_hu62f23b119c2037d99ec8d84019258fc6_7906_500x0_resize_q75_h2_box_2.webp /blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-simple.webp" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-simple.webp alt="WAE Inline Adapter" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Mechanical bypass mode prevents the
<a href=http://www.cisco.com/en/US/docs/app_ntwk_services/waas/wae/installation/7341-7371/guide/7300inln.html title="WAE Inline Adapter" target=_blank rel=noopener>WAE Inline Adapter</a>
from becoming a single point of failure and allows traffic to continue to flow between the router and the client while it passes through an unresponsive WAE without being processed. Anyway, the traffic won&rsquo;t be optimized if the WAE will fail. Serial inline cluster is designed for high-availability failover only:</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-cluster-inline.webp><img sizes="500 649 " srcset="/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-cluster-inline_huc064b9f5e582ff458f27db21c37a2ecb_6572_500x0_resize_q75_h2_box_2.webp /blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-cluster-inline.webp" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-cluster-inline.webp alt="HA Cluster Inline" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>A serial inline cluster is not designed to provide load balancing or a method for scaling traffic beyond the capacity of a single Cisco WAAS device.</p><p>My opinion (and experience with other vendors) is that sometimes bypass mode does not work properly, so a better topology could be the following:</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-redundant.webp><img sizes="500 548 " srcset="/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-redundant_hub91bec2ba6f97aafb4ef17e70d657653_8420_500x0_resize_q75_h2_box_2.webp /blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-redundant.webp" src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/inline-redundant.webp alt="Inline Redundant" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>In the example above if the WAE will fail and the bypass mode won&rsquo;t work, the active router will lose all routing from the WAN and can lower the HSRP priority to become the standby router. Of course, the traffic won&rsquo;t be optimized anymore.</p><h2 id=wccp>WCCP</h2><p>To scale a WAAS installation, WCCP must be used. WCCP is a Cisco-developed content-routing protocol that provides a mechanism to redirect traffic flows in real-time. It has built-in load balancing, scaling, fault tolerance, and service-assurance (fail-safe) mechanisms.</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-simple.webp><img sizes="435 " srcset=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-simple.webp src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-simple.webp alt="WCCP Simple" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>In the above topology:</p><ol><li>the client sends traffic to the WAN, the router (a.k.a. WCCP Server) redirects the traffic to the WAE (a.k.a. WCCP Client);</li><li>the WAE optimizes traffic and sends it back to the router which forwards it to the WAN;</li><li>the returning optimized traffic is received by the router and redirected to the WAE;</li><li>the WAE restores the original traffic (uncompressed) and sends it back to the router which forwards the traffic to the client.</li></ol><p>A WCCP service group defines a set of characteristics about what types of traffic are intercepted, as well as how the intercepted traffic should be handled. Service groups can be well-known (0-50) or dynamic. Well-known services also referred to as static services, have a fixed set of characteristics that are known by both the WCCP server (IOS) and the client. The characteristics of a dynamic service are communicated to the WCCP server (IOS) when the client joins the service group.</p><p>The forwarding method defines how traffic that is being redirected from the router to the WAE is transmitted across the network (1,3). Two options are available:</p><ul><li>WCCP GRE: is the default forwarding method, encapsulates the intercepted packet in an IP GRE header with a source IP address of the WCCP server (IOS) and a destination IP address of the target WCCP client.</li><li>WCCP L2: only available on hardware-based platforms such as the Catalyst series switches, simply rewrites the destination MAC address of the intercepted packet to equal the MAC address of the target WCCP client. L2 forwarding requires that the WCCP server (IOS) is Layer 2 adjacent to the WCCP client.</li></ul><p>The return method defines how the traffic returns from the WAE to the router. Three options are available:</p><ul><li>Generic GRE or WCCP GRE: traffic returning from the WAE to the router is encapsulated using a GRE tunnel, with a destination IP address of the WCCP router-id and a source IP of the WAE itself. When the packet is received by the router, the GRE encapsulation is removed and the packet is forwarded. Generic GRE is for a hardware-based platform like Catalyst 6k, and WCCP GRE is for other platforms.</li><li>IP Forwarding: packets from the WAE to the router are redirected using the IP forwarding table, typically using the default gateway address.</li></ul><p>Let&rsquo;s choose two WCCP dynamic service numbers: one service will be used from the client to the WAN (61), and the other service will be used for return traffic from the WAN to the client (62).</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-services.webp><img sizes="435 " srcset=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-services.webp src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-services.webp alt="WCCP Services" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>Given the above topology, service 61 can be redirected to the WAE:</p><ul><li>using the GigabitEthernet0/0 (ingress packets);</li><li>using the GigabitEthernet0/1 (egress packets).</li></ul><p>Service 62 can be redirected to the WAE:</p><ul><li>using the GigabitEthernet0/1 (ingress packets);</li><li>using the GigabitEthernet0/0 (egress packets);</li></ul><p>The forwarding method should be WCCP GRE and the egress method can be both WCCP GRE or IP Forwarding (the second one will be used).</p><p>The router configuration is the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ip wccp 61
</span></span><span style=display:flex><span>ip wccp 62
</span></span><span style=display:flex><span>interface GigabitEthernet0/0
</span></span><span style=display:flex><span> ip wccp 61 redirect in
</span></span><span style=display:flex><span>interface GigabitEthernet0/1
</span></span><span style=display:flex><span> ip wccp 62 redirect in
</span></span><span style=display:flex><span>interface GigabitEthernet1/0
</span></span><span style=display:flex><span> ip wccp redirect exclude in
</span></span></code></pre></div><p>The interface connected to the WAE must be configured with the &ldquo;exclude in&rdquo; options; otherwise, packets will loop.
Another equivalent configuration could be the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ip wccp 61
</span></span><span style=display:flex><span>ip wccp 62
</span></span><span style=display:flex><span>interface GigabitEthernet0/1
</span></span><span style=display:flex><span> ip wccp 61 redirect out
</span></span><span style=display:flex><span> ip wccp 62 redirect in
</span></span><span style=display:flex><span>interface GigabitEthernet1/0
</span></span><span style=display:flex><span> ip wccp redirect exclude in
</span></span></code></pre></div><p>The <code>redirect in</code> option is less CPU consuming and it should be preferred over the <code>redirect out</code> option; so the first proposed configuration is better than the second one.</p><p>If the WAE is located in the same network as the clients, the egress method must be WCCP GRE or packets will loop:</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-same-net.webp><img sizes="435 " srcset=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-same-net.webp src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/wccp-same-net.webp alt="WCCP Same Net" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>A GRE Tunnel must be configured between the router and the WAE, and traffic flowing through it must be excluded by WCCP redirect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ip wccp 61
</span></span><span style=display:flex><span>ip wccp 62
</span></span><span style=display:flex><span>interface GigabitEthernet0/0
</span></span><span style=display:flex><span> ip wccp 61 redirect in
</span></span><span style=display:flex><span>interface GigabitEthernet1/0
</span></span><span style=display:flex><span> ip wccp 62 redirect in
</span></span><span style=display:flex><span>interface Tunnel1
</span></span><span style=display:flex><span> ip unnumbered GigabitEthernet0/0
</span></span><span style=display:flex><span> ip wccp redirect exclude in
</span></span><span style=display:flex><span> tunnel source GigabitEthernet0/0
</span></span><span style=display:flex><span> tunnel destination &lt;WAE IP&gt;
</span></span></code></pre></div><p>This is not a general rule, but WCCP is simpler if you mind that:</p><ul><li>an interface must be dedicated to the WAE: it can be physical or virtual (tunnel);</li><li>the interface to the WAE must be excluded by WCCP redirect;</li><li>use &ldquo;redirect in&rdquo; to redirect traffic from and to the WAE.</li></ul><p>With IOS routers, the redirect method must be &ldquo;WCCP GRE&rdquo; and the Egress method can be IP Forwarding or WCCP GRE. WCCP GRE must be used if WAE is now in a dedicated VLAN: in this case, a GRE Tunnel must be configured in the router.</p><h3 id=ha-and-scaling-out-using-wccp>HA and scaling out using WCCP</h3><p>WCCP allows routers to balance the traffic load between more WAE appliances:</p><p><a data-fancybox=gallery href=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-and-scaling.webp><img sizes="378 " srcset=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-and-scaling.webp src=/blog/2013/08/27/cisco-wide-area-application-services-system-waas/wave/wae/ha-and-scaling.webp alt="WAAS HA and scaling" class="img-fluid rounded shadow mx-auto d-block text-center"></a></p><p>When more WAE appliances (WCCP clients) are registered in the same service group, WCCP automatically distributes intercepted traffic across all of the WAE in the same service group. The mechanism that determines how intercepted traffic is distributed across the WCCP clients in the service group is called the assignment method. In WCCPv2, there are two available assignment methods: hash assignment and mask assignment. Mask should be preferred over Hash for better performance but it&rsquo;s available on Cisco Catalyst switches only. Cisco IOS routers want Hash assignment.</p><p>With Generic/WCCP GRE egress methods are used. For the Catalyst 6500 platform to process GRE traffic in hardware, a single point-to-multipoint tunnel should be used.</p><h2 id=references>References</h2><ul><li><a href=http://www.cisco.com/en/US/docs/app_ntwk_services/waas/waas/v413/configuration/guide/intro.html#wp1160313 title="Introduction to Cisco WAAS" target=_blank rel=noopener>Introduction to Cisco WAAS</a></li><li><a href=http://www.cisco.com/en/US/products/ps6870/products_installation_and_configuration_guides_list.html title="Cisco Wide Area Application Services Configuration Guide (Software Version" target=_blank rel=noopener>Cisco Wide Area Application Services Configuration Guide (Software Version</a></li><li><a href="http://books.google.it/books/about/Deploying_Cisco_Wide_Area_Application_Se.html?id=tk1inCVI8fUC&amp;redir_esc=y" title="Deploying Cisco Wide Area Application Services" target=_blank rel=noopener>Deploying Cisco Wide Area Application Services</a></li><li><a href="https://www.ciscolive365.com/connect/sessionDetail.ww?SESSION_ID=5885&amp;tclass=popup" title="Deploying Cisco Wide Area Application Services (WAAS) (2013 London)" target=_blank rel=noopener>Deploying Cisco Wide Area Application Services (WAAS) (2013 London)</a></li><li><a href=http://www.cisco.com/en/US/docs/app_ntwk_services/waas/wae/installation/7341-7371/guide/7300inln.html title="WAE Inline Network Adapter" target=_blank rel=noopener>WAE Inline Network Adapter</a></li><li><a href=http://www.cisco.com/web/services/news/ts_newsletter/tech/chalktalk/archives/200806.html title="WCCPv2 Overview and Implementation Best Practices" target=_blank rel=noopener>WCCPv2 Overview and Implementation Best Practices</a></li><li><a href=https://supportforums.cisco.com/docs/DOC-15128 title="Common WAAS/WCCP issues on interactions with Security Devices" target=_blank rel=noopener>Common WAAS/WCCP issues on interactions with Security Devices</a></li><li><a href=https://supportforums.cisco.com/docs/DOC-29677 title="Verify Auto-Discovery on Cisco WAAS" target=_blank rel=noopener>Verify Auto-Discovery on Cisco WAAS</a></li><li><a href=http://www.cisco.com/en/US/partner/docs/app_ntwk_services/waas/waas/v531/configuration/guide/filesvr.html#wp1185285 title="Configuring File Services" target=_blank rel=noopener>Configuring File Services</a></li><li><a href=http://www.cisco.com/en/US/products/ps6474/prod_models_comparison.html title="Cisco Wide Area Virtualization Engine (WAVE): Models Comparison" target=_blank rel=noopener>Cisco Wide Area Virtualization Engine (WAVE): Models Comparison</a></li><li><a href=http://www.cisco.com/en/US/prod/collateral/contnetw/ps5680/ps6870/white_paper_c11-609580.html title="Configuring WAEs for a Graceful Shutdown of WCCP" target=_blank rel=noopener>Configuring WAEs for a Graceful Shutdown of WCCP</a></li></ul></div></div></article><div class=clear></div></div></div></div></div></div></div></main><footer class=d-print-none><div class=footer-profile><div class=container id=contact><div class=row><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h2><span>Andrea</span> Dainese</h2></div><p>For information, collaborations, proposals, requests for help, donations, use one of the following channels; email is preferred.</p><div class=footer-icons><ul><li><a href=https://www.patreon.com/adainese title="Support me" target=_blank rel=noreferrer><i class="fa fa-heart"></i></a></li><li><a href=https://www.linkedin.com/in/adainese/ title="LinkedIn profile" target=_blank rel=noreferrer><i class="fab fa-linkedin-in"></i></a></li><li><a href=https://twitter.com/adainese title="Twitter profile" target=_blank rel=noreferrer><i class="fab fa-twitter"></i></a></li><li><a href=mailto:andrea@adainese.it title="Secure email" target=_blank rel=noreferrer><i class="fa fa-envelope"></i></a></li><li><a href=https://www.spreaker.com/podcast/info-sec-unplugged--6025156 title=Podcast target=_blank rel=noreferrer><i class="fa fa-podcast"></i></a></li><li><a href=https://github.com/dainok/ title="GitHub repositories" target=_blank rel=noreferrer><i class="fab fa-github"></i></a></li><li><a href=/blog/index.xml title="RSS Feed" target=_blank><i class="fa fa-rss"></i></a></li></ul></div></div><div class="col-xs-12 col-sm-12 col-md-4"><div class=footer-head><h4>Past events</h4></div><div class=footer-content><ul><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20240305-cisco-aci-automation.pdf title="View slides" target=_blank rel=noreferrer>SDN: Software Defined Now</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20231122-cybercrime.pdf title="View slides" target=_blank rel=noreferrer>Cybercrime</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220901-bgp-attack-scenarios.pdf title="View slides" target=_blank rel=noreferrer>BGP attack scenarios</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20220317-approaching-ot-ics-security.pdf title="View slides" target=_blank rel=noreferrer>Approaching OT/ICS Security</a> (with <a href=https://www.festocte.it/eventi/industry_4_0/17-03-2022/webinar_la_cybersecurity_nelle_reti_di_fabbrica_P/>Festo Academy</a>)</li><li><a href="https://www.youtube.com/watch?v=sjQZghTkHkA" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200922-cyberrange.pdf title="View slides" target=_blank rel=noreferrer>Cyber Range: Analyzing a Cyber Attack</a></li><li><a href="https://www.youtube.com/watch?v=-PWtGaS28dk" title="View recording" target=_blank rel=noreferrer><i class="fa fa-video"></i></a>&nbsp;-&nbsp;<a href=/files/slides/20200623-clubitfvg-securing-ot-ics-plants.pdf title="View slides" target=_blank rel=noreferrer>Securing OT/ICS plants</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20190226-automation-for-cisco-netops.pdf title="View slides" target=_blank rel=noreferrer>Automation for Cisco NetOps</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181107-ciscon-sdn-complexity-and-tco-looking-for-an-easy-way.pdf title="View slides" target=_blank rel=noreferrer>SDN, Complexity and TCO</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20181003-nts-protection-and-visibility-for-enterprise-networks.pdf title="View slides" target=_blank rel=noreferrer>Protection and visibility for enterprise networks</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20141106-festival-ict-why-wan-accelerators-still-matter.pdf title="View slides" target=_blank rel=noreferrer>Why WAN AccelerAtors (still) matter?</a></li><li><i class="fa fa-video-slash"></i>&nbsp;-&nbsp;<a href=/files/slides/20130918-festival-ict-designing-an-hybrid-data-center-infrastructure.pdf title="View slides" target=_blank rel=noreferrer>Designing an Hybrid Data Center Infrastructure</a></li></ul></div></div><div class="d-none d-md-block col-md-4"><div class=footer-head><h4>Competencies</h4></div><div class=footer-slides><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/security-125x100.webp alt="Incident Response"><div class=overlay>Incident Response</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/ciso-125x100.webp alt=Advisor><div class=overlay>Advisor</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/osint-125x100.webp alt="Open Source Intelligence (OSINT)"><div class=overlay>Open Source Intelligence (OSINT)</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/infrastructure-125x100.webp alt="System Integration / Automation"><div class=overlay>System Integration / Automation</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/writeup-125x100.webp alt="Training / Education / Cyber Range"><div class=overlay>Training / Education / Cyber Range</div></div></div><div class=footer-slide-container><div class=footer-slide><img src=/images/categories/personal-security-125x100.webp alt="Personal Security"><div class=overlay>Personal Security</div></div></div></div></div></div></div></div><div class=footer-copyright><div class=container><div class=row><div class="col-md-12 col-sm-12 col-xs-12"><div class=text-center>&copy; Copyright <strong>Andrea Dainese</strong>. All Rights Reserved</div><div class=text-center>Designed by <a href=https://bootstrapmade.com/ title=BootstrapMade target=_blank rel=noreferrer>BootstrapMade</a></div></div></div></div></div></footer><script src=/plugins/jquery/jquery.min.js></script>
<script src=/plugins/bootstrap/js/bootstrap.min.js></script>
<script src=/plugins/fancybox/jquery.fancybox.min.js></script>
<script src=/plugins/goodshare/goodshare.min.js></script>
<script src=/plugins/fuse/fuse.min.js></script>
<script src=/plugins/jquery-mark/jquery.mark.min.js></script>
<script src=/js/main.js></script>
<script src=/js/search.js></script></body></html>